<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Runtime Structure &#8212; WebAssembly 1.0</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="WebAssembly 1.0" href="../index.html" />
    <link rel="up" title="Execution" href="index.html" />
    <link rel="next" title="Numerics" href="numerics.html" />
    <link rel="prev" title="Conventions" href="conventions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <script type="text/javascript">MathJax.Hub.Config({TeX: {MAXBUFFER: 30*1024}})</script><body role="document">
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/webassembly.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syntax/index.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../valid/index.html">Validation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Execution</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Runtime Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#values">Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#store">Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="#addresses">Addresses</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-instances">Module Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function-instances">Function Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#table-instances">Table Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memory-instances">Memory Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#global-instances">Global Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-instances">Export Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-values">External Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stack">Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#administrative-instructions">Administrative Instructions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="numerics.html">Numerics</a></li>
<li class="toctree-l2"><a class="reference internal" href="instructions.html">Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../binary/index.html">Binary Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../text/index.html">Text Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../syntax/instrindex.html">Index of Instructions</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="../genindex.html">Index</a></li>
    
    <li class="toctree-l1"><a href="../_download/WebAssembly.pdf">Download as PDF</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="runtime-structure">
<span id="syntax-runtime"></span><span id="index-0"></span><h1>Runtime Structure<a class="headerlink" href="#runtime-structure" title="Permalink to this headline">¶</a></h1>
<div class="section" id="values">
<span id="syntax-val"></span><span id="index-1"></span><h2>Values<a class="headerlink" href="#values" title="Permalink to this headline">¶</a></h2>
<p>WebAssembly computations manipulate <em>values</em> of the four basic <a class="reference internal" href="../syntax/types.html#syntax-valtype"><span class="std std-ref">value types</span></a>: <a class="reference internal" href="../syntax/values.html#syntax-int"><span class="std std-ref">integers</span></a> and <a class="reference internal" href="../syntax/values.html#syntax-float"><span class="std std-ref">floating-point data</span></a> of 32 or 64 bit width each, respectively.</p>
<p>In most places of the semantics, values of different types can occur.
In order to avoid ambiguities, values are therefore represented with an abstract syntax that makes their type explicit.
It is convenient to reuse the same notation as for the <span class="math">\(\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}\)</span> <a class="reference internal" href="../syntax/instructions.html#syntax-const"><span class="std std-ref">instructions</span></a> producing them:</p>
<div class="math">
\[\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(value)} &amp; \href{../exec/runtime.html#syntax-val}{\mathit{val}} &amp;::=&amp;
  \href{../syntax/types.html#syntax-valtype}{\mathsf{i32}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-int}{\def\mathdef1150#1{{\mathit{i}#1}}\mathdef1150{\mathit{32}}} ~|~
  \href{../syntax/types.html#syntax-valtype}{\mathsf{i64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-int}{\def\mathdef1151#1{{\mathit{i}#1}}\mathdef1151{\mathit{64}}} ~|~
  \href{../syntax/types.html#syntax-valtype}{\mathsf{f32}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-float}{\def\mathdef1154#1{{\mathit{f}#1}}\mathdef1154{\mathit{32}}} ~|~
  \href{../syntax/types.html#syntax-valtype}{\mathsf{f64}}.\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~\href{../syntax/values.html#syntax-float}{\def\mathdef1155#1{{\mathit{f}#1}}\mathdef1155{\mathit{64}}}
\end{array}\]</div>
</div>
<div class="section" id="store">
<span id="syntax-store"></span><span id="index-2"></span><span id="id1"></span><h2>Store<a class="headerlink" href="#store" title="Permalink to this headline">¶</a></h2>
<p>The <em>store</em> represents all global state that can be manipulated by WebAssembly programs.
It consists of the runtime representation of all <em>instances</em> of <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">functions</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">tables</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memories</span></a>, and <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">globals</span></a> that have been <em>allocated</em> during the life time of the abstract machine. <a class="footnote-reference" href="#gc" id="id2">[1]</a></p>
<p>Syntactically, the store is defined as a <a class="reference internal" href="../syntax/conventions.html#syntax-record"><span class="std std-ref">record</span></a> listing the existing instances of each category:</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(store)} &amp; \href{../exec/runtime.html#syntax-store}{\mathit{store}} &amp;::=&amp; \{~
  \begin{array}[t]{l&#64;{~}ll}
  \mathsf{funcs} &amp; \href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}^\ast, \\
  \mathsf{tables} &amp; \href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}^\ast, \\
  \mathsf{mems} &amp; \href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}^\ast, \\
  \mathsf{globals} &amp; \href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}}^\ast ~\} \\
  \end{array}
\end{array}\end{split}\]</div>
<table class="docutils footnote" frame="void" id="gc" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>In practice, implementations may apply techniques like garbage collection to remove objects from the store that are no longer referenced.
However, such techniques are not semantically observable,
and hence outside the scope of this specification.</td></tr>
</tbody>
</table>
<div class="section" id="convention">
<h3>Convention<a class="headerlink" href="#convention" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The meta variable <span class="math">\(S\)</span> ranges over stores where clear from context.</li>
</ul>
</div>
</div>
<div class="section" id="addresses">
<span id="syntax-addr"></span><span id="syntax-globaladdr"></span><span id="syntax-memaddr"></span><span id="syntax-tableaddr"></span><span id="syntax-funcaddr"></span><span id="index-3"></span><h2>Addresses<a class="headerlink" href="#addresses" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">Function instances</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">table instances</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory instances</span></a>, and <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">global instances</span></a> in the <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a> are referenced with abstract <em>addresses</em>.
These are simply indices into the respective store component.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(address)} &amp; \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} &amp;::=&amp;
  0 ~|~ 1 ~|~ 2 ~|~ \dots \\
\def\mathdef1133#1{{}}\mathdef1133{(function address)} &amp; \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\def\mathdef1133#1{{}}\mathdef1133{(table address)} &amp; \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\def\mathdef1133#1{{}}\mathdef1133{(memory address)} &amp; \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\def\mathdef1133#1{{}}\mathdef1133{(global address)} &amp; \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-addr}{\mathit{addr}} \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Addresses are <em>dynamic</em>, globally unique references to runtime objects,
in contrast to <a class="reference internal" href="../syntax/modules.html#syntax-index"><span class="std std-ref">indices</span></a>,
which are <em>static</em>, module-local references to their original definitions.
A <em>memory address</em> <span class="math">\(\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}\)</span> denotes the abstract address <em>of</em> a memory <em>instance</em> in the store,
not an offset <em>inside</em> a memory instance.</p>
<p class="last">There is no specific limit on the number of allocations of store objects,
hence logical addresses can be arbitrarily large natural numbers.</p>
</div>
<p>An <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> may assign identity to <a class="reference internal" href="../syntax/modules.html#syntax-export"><span class="std std-ref">exported</span></a> store objects corresponding to their addresses,
even where this identity is not observable from within WebAssembly code itself
(such as for <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">function instances</span></a> or immutable <a class="reference internal" href="../syntax/modules.html#syntax-global"><span class="std std-ref">globals</span></a>).</p>
</div>
<div class="section" id="module-instances">
<span id="syntax-moduleinst"></span><span id="index-4"></span><h2>Module Instances<a class="headerlink" href="#module-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>module instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a>.
It is created by <a class="reference internal" href="../intro/overview.html#instantiation"><span class="std std-ref">instantiating</span></a> a module,
and collects runtime representations of all entities that are imported, defined, or exported by the module.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(module instance)} &amp; \href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}} &amp;::=&amp; \{
  \begin{array}[t]{l&#64;{~}ll}
  \mathsf{types} &amp; \href{../syntax/types.html#syntax-functype}{\mathit{functype}}^\ast, \\
  \mathsf{funcs} &amp; \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}^\ast, \\
  \mathsf{tables} &amp; \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}^\ast, \\
  \mathsf{mems} &amp; \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}^\ast, \\
  \mathsf{globals} &amp; \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}^\ast \\
  \mathsf{exports} &amp; \href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}}^\ast ~\} \\
  \end{array}
\end{array}\end{split}\]</div>
<p>Each component references runtime instances corresponding to respective declarations from the original module &#8211; whether imported or defined &#8211; in the order of their static <a class="reference internal" href="../syntax/modules.html#syntax-index"><span class="std std-ref">indices</span></a>.
<a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">Function instances</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">table instances</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory instances</span></a>, and <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">global instances</span></a> are referenced with an indirection through their respective <a class="reference internal" href="#syntax-addr"><span class="std std-ref">addresses</span></a> in the <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a>.</p>
<p>It is an invariant of the semantics that all <a class="reference internal" href="#syntax-exportinst"><span class="std std-ref">export instances</span></a> in a given module instance have different <a class="reference internal" href="../syntax/values.html#syntax-name"><span class="std std-ref">names</span></a>.</p>
</div>
<div class="section" id="function-instances">
<span id="syntax-funcinst"></span><span id="syntax-hostfunc"></span><span id="index-5"></span><h2>Function Instances<a class="headerlink" href="#function-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>function instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-func"><span class="std std-ref">function</span></a>.
It effectively is a <em>closure</em> of the original function over the runtime <a class="reference internal" href="#syntax-moduleinst"><span class="std std-ref">module instance</span></a> of its own <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a>.
The module instance is used to resolve references to other non-local definitions during execution of the function.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(function instance)} &amp; \href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}} &amp;::=&amp;
  \{ \mathsf{type}~\href{../syntax/types.html#syntax-functype}{\mathit{functype}}, \mathsf{module}~\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}, \mathsf{code}~\href{../syntax/modules.html#syntax-func}{\mathit{func}} \} \\ &amp;&amp;|&amp;
  \{ \mathsf{type}~\href{../syntax/types.html#syntax-functype}{\mathit{functype}}, \mathsf{code}~\href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}} \} \\
\def\mathdef1133#1{{}}\mathdef1133{(host function)} &amp; \href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}} &amp;::=&amp; \dots \\
\end{array}\end{split}\]</div>
<p>A <em>host function</em> is a function expressed outside WebAssembly but passed to a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a> as an <a class="reference internal" href="../syntax/modules.html#syntax-import"><span class="std std-ref">import</span></a>.
The definition and behavior of host functions are outside the scope of this specification.
For the purpose of this specification, it is assumed that when <a class="reference internal" href="instructions.html#exec-invoke-host"><span class="std std-ref">invoked</span></a>,
a host function behaves non-deterministically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Function instances are immutable, and their identity is not observable by WebAssembly code.
However, the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> might provide implicit or explicit means for distinguishing their <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">addresses</span></a> when <a class="reference internal" href="../syntax/modules.html#syntax-export"><span class="std std-ref">exported</span></a>, either directly or through an entry in a <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">table</span></a>.</p>
</div>
</div>
<div class="section" id="table-instances">
<span id="syntax-tableinst"></span><span id="syntax-funcelem"></span><span id="index-6"></span><h2>Table Instances<a class="headerlink" href="#table-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>table instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">table</span></a>.
It holds a vector of <em>function elements</em> and an optional maximum size, if one was specified at the definition site of the table.</p>
<p>Each function element is either empty, representing an uninitialized table entry, or a <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">function address</span></a>.
Function elements can be mutated through the execution of an <a class="reference internal" href="../syntax/modules.html#syntax-elem"><span class="std std-ref">element segment</span></a> or by external means provided by the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a>.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(table instance)} &amp; \href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}} &amp;::=&amp;
  \{ \mathsf{elem}~\href{../syntax/values.html#syntax-vec}{\mathit{vec}}(\href{../exec/runtime.html#syntax-funcelem}{\mathit{funcelem}}), \mathsf{max}~\href{../syntax/values.html#syntax-int}{\def\mathdef1142#1{{\mathit{u}#1}}\mathdef1142{\mathit{32}}}^? \} \\
\def\mathdef1133#1{{}}\mathdef1133{(function element)} &amp; \href{../exec/runtime.html#syntax-funcelem}{\mathit{funcelem}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}^? \\
\end{array}\end{split}\]</div>
<p>It is an invariant of the semantics that the length of the element vector never exceeds the maximum size, if present.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Other table elements may be added in future versions of WebAssembly.</p>
</div>
</div>
<div class="section" id="memory-instances">
<span id="syntax-meminst"></span><span id="page-size"></span><span id="index-7"></span><h2>Memory Instances<a class="headerlink" href="#memory-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>memory instance</em> is the runtime representation of a linear <a class="reference internal" href="../syntax/modules.html#syntax-mem"><span class="std std-ref">memory</span></a>.
It holds a vector of bytes and an optional maximum size, if one was specified at the definition site of the memory.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(memory instance)} &amp; \href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}} &amp;::=&amp;
  \{ \mathsf{data}~\href{../syntax/values.html#syntax-vec}{\mathit{vec}}(\href{../syntax/values.html#syntax-byte}{\mathit{byte}}), \mathsf{max}~\href{../syntax/values.html#syntax-int}{\def\mathdef1142#1{{\mathit{u}#1}}\mathdef1142{\mathit{32}}}^? \} \\
\end{array}\end{split}\]</div>
<p>The length of the vector always is a multiple of the WebAssembly <em>page size</em>, which is defined to be the constant <span class="math">\(65536\)</span> &#8211; abbreviated <span class="math">\(64\,\mathrm{Ki}\)</span>.
Like in a <a class="reference internal" href="../syntax/types.html#syntax-memtype"><span class="std std-ref">memory type</span></a>, the maximum size in a memory instance is given in units of this page size.</p>
<p>The bytes can be mutated through <a class="reference internal" href="../syntax/instructions.html#syntax-instr-memory"><span class="std std-ref">memory instructions</span></a>, the execution of a <a class="reference internal" href="../syntax/modules.html#syntax-data"><span class="std std-ref">data segment</span></a>, or by external means provided by the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a>.</p>
<p>It is an invariant of the semantics that the length of the byte vector, divided by page size, never exceeds the maximum size, if present.</p>
</div>
<div class="section" id="global-instances">
<span id="syntax-globalinst"></span><span id="index-8"></span><h2>Global Instances<a class="headerlink" href="#global-instances" title="Permalink to this headline">¶</a></h2>
<p>A <em>global instance</em> is the runtime representation of a <a class="reference internal" href="../syntax/modules.html#syntax-global"><span class="std std-ref">global</span></a> variable.
It holds an individual <a class="reference internal" href="#syntax-val"><span class="std std-ref">value</span></a> and a flag indicating whether it is mutable.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(global instance)} &amp; \href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}} &amp;::=&amp;
  \{ \mathsf{value}~\href{../exec/runtime.html#syntax-val}{\mathit{val}}, \mathsf{mut}~\href{../syntax/types.html#syntax-mut}{\mathit{mut}} \} \\
\end{array}\end{split}\]</div>
<p>The value of mutable globals can be mutated through specific instructions or by external means provided by the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a>.</p>
</div>
<div class="section" id="export-instances">
<span id="syntax-exportinst"></span><span id="index-9"></span><h2>Export Instances<a class="headerlink" href="#export-instances" title="Permalink to this headline">¶</a></h2>
<p>An <em>export instance</em> is the runtime representation of an <a class="reference internal" href="../syntax/modules.html#syntax-export"><span class="std std-ref">export</span></a>.
It defines the export&#8217;s <a class="reference internal" href="../syntax/values.html#syntax-name"><span class="std std-ref">name</span></a> and the <a class="reference internal" href="#syntax-externval"><span class="std std-ref">external value</span></a> being exported.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(export instance)} &amp; \href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}} &amp;::=&amp;
  \{ \mathsf{name}~\href{../syntax/values.html#syntax-name}{\mathit{name}}, \mathsf{value}~\href{../exec/runtime.html#syntax-externval}{\mathit{externval}} \} \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="external-values">
<span id="syntax-externval"></span><span id="index-10"></span><h2>External Values<a class="headerlink" href="#external-values" title="Permalink to this headline">¶</a></h2>
<p>An <em>external value</em> is the runtime representation of an entity that can be imported or exported.
It is an <a class="reference internal" href="#syntax-addr"><span class="std std-ref">address</span></a> denoting either a <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">function instance</span></a>, <a class="reference internal" href="#syntax-tableinst"><span class="std std-ref">table instance</span></a>, <a class="reference internal" href="#syntax-meminst"><span class="std std-ref">memory instance</span></a>, or <a class="reference internal" href="#syntax-globalinst"><span class="std std-ref">global instances</span></a> in the shared <a class="reference internal" href="#syntax-store"><span class="std std-ref">store</span></a>.</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(external value)} &amp; \href{../exec/runtime.html#syntax-externval}{\mathit{externval}} &amp;::=&amp;
  \mathsf{func}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} ~|~
  \mathsf{table}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}} ~|~
  \mathsf{mem}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} ~|~
  \mathsf{global}~\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}} \\
\end{array}\end{split}\]</div>
<div class="section" id="conventions">
<h3>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h3>
<p>The following auxiliary notation is defined for sequences of external values.
It filters out entries of a specific kind in an order-preserving fashion:</p>
<div class="math">
\[\begin{split}\begin{array}{lcl}
\href{../syntax/types.html#syntax-externtype}{\mathrm{funcs}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) &amp;=&amp; [\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} ~|~ (\mathsf{func}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast] \\
\href{../syntax/types.html#syntax-externtype}{\mathrm{tables}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) &amp;=&amp; [\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}} ~|~ (\mathsf{table}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast] \\
\href{../syntax/types.html#syntax-externtype}{\mathrm{mems}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) &amp;=&amp; [\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}} ~|~ (\mathsf{mem}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast] \\
\href{../syntax/types.html#syntax-externtype}{\mathrm{globals}}(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) &amp;=&amp; [\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}} ~|~ (\mathsf{global}~\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}) \in \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast] \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="stack">
<span id="label"></span><span id="frame"></span><span id="syntax-label"></span><span id="syntax-frame"></span><span id="index-11"></span><span id="id3"></span><h2>Stack<a class="headerlink" href="#stack" title="Permalink to this headline">¶</a></h2>
<p>Besides the <a class="reference internal" href="#store"><span class="std std-ref">store</span></a>, most <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instructions</span></a> interact with an implicit <em>stack</em>.
The stack contains three kinds of entries:</p>
<ul class="simple">
<li><em>Values</em>: the <em>operands</em> (arguments and results) of instructions.</li>
<li><em>Labels</em>: active (entered) <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">structured control instructions</span></a> that can be targeted by branches.</li>
<li><em>Activations</em>: the <em>call frames</em> of active <a class="reference internal" href="../syntax/modules.html#syntax-func"><span class="std std-ref">function</span></a> calls.</li>
</ul>
<p>These entries can occur on the stack in any order during the execution of a program.
Stack entries are described by abstract syntax as follows.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to model the WebAssebmly semantics using separate stacks for operands, control constructs, and calls.
However, because the stacks are interdependent, additional book keeping about associated stack heights would be required.
For the purpose of this specification, an interleaved representation is simpler.</p>
</div>
<div class="section" id="id4">
<h3>Values<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Values are represented by <a class="reference internal" href="#syntax-val"><span class="std std-ref">themselves</span></a>.</p>
</div>
<div class="section" id="labels">
<h3>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h3>
<p>Labels carry an argument arity <span class="math">\(n\)</span> and their associated branch <em>target</em>, which is expressed syntactically as an <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instruction</span></a> sequence:</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(label)} &amp; \href{../exec/runtime.html#syntax-label}{\mathit{label}} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\} \\
\end{array}\end{split}\]</div>
<p>Intuitively, <span class="math">\(\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\)</span> is the <em>continuation</em> to execute when the branch is taken, in place of the original control construct.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For example, a loop label has the form</p>
<div class="math">
\[\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{loop}}~[t^?]~\dots~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\}\]</div>
<p>When performing a branch to this label, this executes the loop, effectively restarting it from the beginning.
Conversely, a simple block label has the form</p>
<div class="math">
\[\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\epsilon\}\]</div>
<p class="last">When branching, the empty continuation ends the targeted block, such that execution can proceed with consecutive instructions.</p>
</div>
</div>
<div class="section" id="frames">
<h3>Frames<a class="headerlink" href="#frames" title="Permalink to this headline">¶</a></h3>
<p>Activation frames carry the return arity of the respective function,
hold the values of its <a class="reference internal" href="../syntax/modules.html#syntax-local"><span class="std std-ref">locals</span></a> (including arguments) in the order corresponding to their static <a class="reference internal" href="../syntax/modules.html#syntax-localidx"><span class="std std-ref">local indices</span></a>,
and a reference to the function&#8217;s own <a class="reference internal" href="#syntax-moduleinst"><span class="std std-ref">module instance</span></a>:</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(activation)} &amp; \mathit{activation} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{frame}}_n\{\href{../exec/runtime.html#syntax-frame}{\mathit{frame}}\} \\
\def\mathdef1133#1{{}}\mathdef1133{(frame)} &amp; \href{../exec/runtime.html#syntax-frame}{\mathit{frame}} &amp;::=&amp;
  \{ \mathsf{locals}~\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast, \mathsf{module}~\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}\} \\
\end{array}\end{split}\]</div>
<p>The values of the locals are mutated by respective <a class="reference internal" href="../syntax/instructions.html#syntax-instr-variable"><span class="std std-ref">variable instructions</span></a>.</p>
</div>
<div class="section" id="id5">
<h3>Conventions<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The meta variable <span class="math">\(L\)</span> ranges over labels where clear from context.</li>
<li>The meta variable <span class="math">\(F\)</span> ranges over frames where clear from context.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the current version of WebAssembly, the arities of labels and activations cannot be larger than <span class="math">\(1\)</span>.
This may be generalized in future versions.</p>
</div>
</div>
</div>
<div class="section" id="administrative-instructions">
<span id="syntax-instr-admin"></span><span id="syntax-invoke"></span><span id="syntax-trap"></span><span id="index-12"></span><h2>Administrative Instructions<a class="headerlink" href="#administrative-instructions" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is only relevant for the <a class="reference internal" href="conventions.html#exec-notation"><span class="std std-ref">formal notation</span></a>.</p>
</div>
<p>In order to express the reduction of <a class="reference internal" href="../intro/overview.html#trap"><span class="std std-ref">traps</span></a>, calls, and <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">control instructions</span></a>, the syntax of instructions is extended to include the following <em>administrative instructions</em>:</p>
<div class="math">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1133#1{{}}\mathdef1133{(administrative instruction)} &amp; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}} &amp;::=&amp;
  \dots \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-invoke}{\mathsf{invoke}}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{frame}}_n\{\href{../exec/runtime.html#syntax-frame}{\mathit{frame}}\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\
\end{array}\end{split}\]</div>
<p>The <span class="math">\(\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}}\)</span> instruction represents the occurrence of a trap.
Traps are bubbled up through nested instruction sequences, ultimately reducing the entire program to a single <span class="math">\(\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}}\)</span> instruction, signalling termination.</p>
<p>The <span class="math">\(\href{../exec/runtime.html#syntax-invoke}{\mathsf{invoke}}\)</span> instruction represents the imminent invocation of a <a class="reference internal" href="#syntax-funcinst"><span class="std std-ref">function instance</span></a>, identified by its <a class="reference internal" href="#syntax-funcaddr"><span class="std std-ref">address</span></a>.
It unifies the handling of different forms of calls.</p>
<p>The <span class="math">\(\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}\)</span> and <span class="math">\(\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{frame}}\)</span> instructions model <a class="reference internal" href="../syntax/instructions.html#syntax-label"><span class="std std-ref">labels</span></a> and <a class="reference internal" href="#syntax-frame"><span class="std std-ref">frames</span></a> <a class="reference internal" href="conventions.html#exec-notation"><span class="std std-ref">&#8220;on the stack&#8221;</span></a>.
Moreover, the administrative syntax maintains the nesting structure of the original <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">structured control instruction</span></a> or <a class="reference internal" href="../syntax/modules.html#syntax-func"><span class="std std-ref">function body</span></a> and their <a class="reference internal" href="../syntax/instructions.html#syntax-instr-seq"><span class="std std-ref">instruction sequences</span></a>.
That way, the end of the inner instruction sequence is tracked when part of an outer sequence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For example, the <a class="reference internal" href="instructions.html#exec-block"><span class="std std-ref">reduction rule</span></a> for <span class="math">\(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{block}}\)</span> is:</p>
<div class="math">
\[\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{block}}~[t^n]~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \quad\hookrightarrow\quad
\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\epsilon\}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\]</div>
<p>This replaces the block with a label instruction,
which can be interpreted as &#8220;pushing&#8221; the label on the stack.
When <span class="math">\(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}\)</span> is reached, i.e., the inner instruction sequence has been reduced to the empty sequence &#8211; or a sequence of <span class="math">\(\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}\)</span> instructions, the representation of non-empty local operand stack &#8211; then the <span class="math">\(\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}\)</span> instruction is eliminated courtesy of its own <a class="reference internal" href="instructions.html#exec-label"><span class="std std-ref">reduction rule</span></a>:</p>
<div class="math">
\[\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \quad\hookrightarrow\quad \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast\]</div>
<p class="last">This can be interpreted as removing the label from the stack and only leaving the locally accumulated operand values.</p>
</div>
<div class="section" id="block-contexts">
<span id="syntax-ctxt-block"></span><span id="index-13"></span><h3>Block Contexts<a class="headerlink" href="#block-contexts" title="Permalink to this headline">¶</a></h3>
<p>To express <a class="reference internal" href="../syntax/instructions.html#syntax-instr-control"><span class="std std-ref">branches</span></a>, the following syntax of <em>block contexts</em> is defined, indexed by the count <span class="math">\(k\)</span> of labels surrounding the hole:</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(block contexts)} &amp; \href{../exec/runtime.html#syntax-ctxt-block}{B}^0 &amp;::=&amp;
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~[\_]~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \\
\def\mathdef1133#1{{}}\mathdef1133{(block contexts)} &amp; \href{../exec/runtime.html#syntax-ctxt-block}{B}^{k+1} &amp;::=&amp;
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../exec/runtime.html#syntax-ctxt-block}{B}^k~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}}~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \\
\end{array}\end{split}\]</div>
<p>This definition allows to index active labels surrounding a <a class="reference internal" href="../syntax/instructions.html#syntax-br"><span class="std std-ref">branch</span></a> or <a class="reference internal" href="../syntax/instructions.html#syntax-return"><span class="std std-ref">return</span></a> instruction.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For example, the <a class="reference internal" href="instructions.html#exec-br"><span class="std std-ref">reduction</span></a> of a simple branch can be defined as follows:</p>
<div class="math">
\[\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_0\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~\href{../exec/runtime.html#syntax-ctxt-block}{B}^l[\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{br}}~l]~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \quad\hookrightarrow\quad \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\]</div>
<p class="last">Here, the hole <span class="math">\([\_]\)</span> of the context is instantiated with a branch instruction.
When a branch occurs,
this rule replaces the targeted label and associated instruction sequence with the label&#8217;s continuation.
The right label is identified through the <a class="reference internal" href="../syntax/modules.html#syntax-labelidx"><span class="std std-ref">label index</span></a> <span class="math">\(l\)</span>, which corresponds to the number of surrounding <span class="math">\(\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}\)</span> instructions that must be hopped over &#8211; which is exactly the count encoded in the index of a block context.</p>
</div>
</div>
<div class="section" id="evaluation-contexts">
<span id="syntax-ctxt-eval"></span><span id="index-14"></span><h3>Evaluation Contexts<a class="headerlink" href="#evaluation-contexts" title="Permalink to this headline">¶</a></h3>
<p>Finally, the following definition of <em>evaluation context</em> and associated structural rules enable reduction inside instruction sequences and administrative forms as well as the propagation of traps:</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(evaluation contexts)} &amp; E &amp;::=&amp;
  [\_] ~|~
  \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast~E~\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast ~|~
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{label}}_n\{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast\}~E~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} ~|~
  \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{frame}}_n\{\href{../exec/runtime.html#syntax-frame}{\mathit{frame}}\}~E~\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{end}} \\
\end{array}\end{split}\]</div>
<div class="math">
\[\begin{split}\begin{array}{lcl&#64;{\qquad}l}
S; F; E[\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast] &amp;\hookrightarrow&amp; S'; F'; E[{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast]
  &amp; (\mbox{if}~S; F; \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}^\ast \hookrightarrow S'; F'; {\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}'}^\ast) \\
S; F; E[\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}}] &amp;\hookrightarrow&amp; S; F; \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}}
  &amp; (\mbox{if}~E \neq [\_]) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="module-instructions">
<span id="syntax-moduleinstr"></span><span id="syntax-init-global"></span><span id="syntax-init-mem"></span><span id="syntax-init-table"></span><span id="syntax-instantiate"></span><span id="index-15"></span><h3>Module Instructions<a class="headerlink" href="#module-instructions" title="Permalink to this headline">¶</a></h3>
<p>Module <a class="reference internal" href="../intro/overview.html#instantiation"><span class="std std-ref">instantiation</span></a> is a complex operation.
It is hence expressed in terms of reduction into smaller steps expressed by a sequence of administrative <em>module instructions</em> that are a superset of ordinary instructions and defined as follow.</p>
<div class="math">
\[\begin{split}\begin{array}{llcl}
\def\mathdef1133#1{{}}\mathdef1133{(module instruction)} &amp; \href{../exec/runtime.html#syntax-moduleinstr}{\mathit{moduleinstr}} &amp;::=&amp;
  \href{../syntax/instructions.html#syntax-instr}{\mathit{instr}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-instantiate}{\mathsf{instantiate}}~\href{../syntax/modules.html#syntax-module}{\mathit{module}}~\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-init_table}{\mathsf{init\_table}}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}~\href{../syntax/values.html#syntax-int}{\def\mathdef1142#1{{\mathit{u}#1}}\mathdef1142{\mathit{32}}}~\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}~funcidx^\ast \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-init_mem}{\mathsf{init\_mem}}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}~\href{../syntax/values.html#syntax-int}{\def\mathdef1142#1{{\mathit{u}#1}}\mathdef1142{\mathit{32}}}~\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-init_global}{\mathsf{init\_global}}~\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}~\href{../exec/runtime.html#syntax-val}{\mathit{val}} \\ &amp;&amp;|&amp;
  \href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}} \\
\end{array}\end{split}\]</div>
<p>The <span class="math">\(\href{../exec/runtime.html#syntax-instantiate}{\mathsf{instantiate}}\)</span> instruction expresses instantiation of a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a> itself, requiring a sequence of <a class="reference internal" href="#syntax-externval"><span class="std std-ref">external values</span></a> for the expected imports.
It reduces into a sequence of initialization instructions for <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">tables</span></a>, <a class="reference internal" href="../syntax/modules.html#syntax-mem"><span class="std std-ref">memories</span></a> and <a class="reference internal" href="../syntax/modules.html#syntax-global"><span class="std std-ref">globals</span></a>,
and a possible <a class="reference internal" href="#syntax-invoke"><span class="std std-ref">invocation</span></a> of the <a class="reference internal" href="../syntax/modules.html#syntax-start"><span class="std std-ref">start function</span></a>.
The final instruction returns the newly created and initialized <a class="reference internal" href="#syntax-moduleinst"><span class="std std-ref">module instance</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The reason for splitting instantiation into individual reduction steps is to provide a semantics that is compatible with future extensions like threads.</p>
<p class="last">Unlike the administrative instructions above,
module instructions <em>embed</em> ordinary instructions <span class="math">\(\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}\)</span> instead of extending them.
Consequently, they can only occur at the top-level.</p>
</div>
<p>Evaluation contexts and additional structural reduction rules for module instructions are defined as follows:</p>
<div class="math">
\[\begin{split}\begin{array}{llll}
\def\mathdef1133#1{{}}\mathdef1133{(module evaluation contexts)} &amp; M &amp;::=&amp;
  E~~\href{../exec/runtime.html#syntax-moduleinstr}{\mathit{moduleinstr}}^\ast \\
\end{array}\end{split}\]</div>
<div class="math">
\[\begin{split}\begin{array}{lcl&#64;{\qquad}l}
S; M[\href{../exec/runtime.html#syntax-moduleinstr}{\mathit{moduleinstr}}] &amp;\hookrightarrow&amp; S'; M[{\href{../exec/runtime.html#syntax-moduleinstr}{\mathit{moduleinstr}}'}^\ast]
  &amp; (\mbox{if}~S; \href{../exec/runtime.html#syntax-moduleinstr}{\mathit{moduleinstr}} \hookrightarrow S'; {\href{../exec/runtime.html#syntax-moduleinstr}{\mathit{moduleinstr}}'}^\ast) \\
S; M[\href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}}] &amp;\hookrightarrow&amp; S; \href{../exec/runtime.html#syntax-instr-admin}{\mathsf{trap}}
  &amp; (\mbox{if}~M \neq [\_]) \\
\end{array}\end{split}\]</div>
<p>Reduction terminates when the sequence has been reduced to a <span class="math">\(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}\)</span> or a trap occurred.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A trap may either arise from invocation of a <a class="reference internal" href="../syntax/modules.html#syntax-start"><span class="std std-ref">start function</span></a> or indicate failure of the <span class="math">\(\href{../exec/runtime.html#syntax-instantiate}{\mathsf{instantiate}}\)</span> instruction itself.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, WebAssembly Community Group.
      
    </div>

    

    
  </body>
</html>