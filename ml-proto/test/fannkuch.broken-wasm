;; FannkuchRedux, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null

(module 

  (func $Program_fannkuch
    (param $n i32) (local $sign i32) (local $maxflips i32) (local $sum i32) 
    (local $j i32) (local $num i32) (local $q0 i32) (local $flag i32) 
    (local $k i32) (local $flips i32) (local $qq i32) (local $flag2 i32) 
    (local $flag3 i32) (local $l i32) (local $m i32) (local $t i32) 
    (local $flag4 i32) (local $flag5 i32) (local $t3 i32) (local $i2 i32) 
    (local $sx i32) (local $flag7 i32) (local $j2 i32) 
    (local $currentLabel_0 i32) 

    (block 

      ;; LabelGroup 0
      (setlocal $currentLabel_0 (const.i32 0))

      (label $labelgroup_0 (loop (label $labelgroup_0_dispatch 
        ;; Begin Label $entry0
        (if (eq.i32 (getlocal $currentLabel_0) (const.i32 0)) 
          (block 
            (setlocal $sign (const.i32 1))
            (setlocal $maxflips (const.i32 0))
            (setlocal $sum (const.i32 0))

            ;; for (var (@<var System.Int32 j> = 0); ...)
            (setlocal $j (const.i32 0))

            (label $loop_4096 
              (loop 
                ;; for (...; (@<var System.Int32 j> < @<parameter System.Int32 n>); ...)

                (if 
                  (lts.i32 
                    (getlocal $j)
                    (getlocal $n)
                  )
                  (nop)
                  (break $loop_4096)
                )

                ;; for (...) { 
                (block 
                  (stores.1.i32 
                    (mul.i32 
                      (add.i32 
                        (const.i32 32)
                        (getlocal $j)
                      )
                      (const.i32 4)
                    )
                    (getlocal $j)
                  )
                  (stores.1.i32 
                    (mul.i32 
                      (add.i32 
                        (const.i32 64)
                        (getlocal $j)
                      )
                      (const.i32 4)
                    )
                    (getlocal $j)
                  )
                  (stores.1.i32 
                    (mul.i32 
                      (add.i32 
                        (const.i32 96)
                        (getlocal $j)
                      )
                      (const.i32 4)
                    )
                    (getlocal $j)
                  )
                  (setlocal $num (getlocal $j))
                  (setlocal $j (add.i32 
                      (getlocal $num)
                      (const.i32 1)
                    ))
                )
              )
            )

            ;; while (<JSBooleanLiteral True>)
            (label $loop_4097 
              (loop 

                (if 
                  (const.i32 1)
                  (nop)
                  (break $loop_4097)
                )

                ;; while (...) { 
                (block 
                  (setlocal $q0 (loads.1.i32 (const.i32 128) ))
                  (setlocal $flag (gts.i32 
                      (getlocal $q0)
                      (const.i32 0)
                    ))

                  (if 
                    (getlocal $flag)
                    (block 

                      ;; for (var (@<var System.Int32 k> = 1); ...)
                      (setlocal $k (const.i32 1))

                      (label $loop_4098 
                        (loop 
                          ;; for (...; (@<var System.Int32 k> < @<parameter System.Int32 n>); ...)

                          (if 
                            (lts.i32 
                              (getlocal $k)
                              (getlocal $n)
                            )
                            (nop)
                            (break $loop_4098)
                          )

                          ;; for (...) { 
                          (block 
                            (stores.1.i32 
                              (mul.i32 
                                (add.i32 
                                  (const.i32 64)
                                  (getlocal $k)
                                )
                                (const.i32 4)
                              )
                              (loads.1.i32 (mul.i32 
                                  (add.i32 
                                    (const.i32 32)
                                    (getlocal $k)
                                  )
                                  (const.i32 4)
                                ) )
                            )
                            (setlocal $num (getlocal $k))
                            (setlocal $k (add.i32 
                                (getlocal $num)
                                (const.i32 1)
                              ))
                          )
                        )
                      )
                      (setlocal $flips (const.i32 1))

                      ;; while (<JSBooleanLiteral True>)
                      (label $loop_3 
                        (loop 

                          (if 
                            (const.i32 1)
                            (nop)
                            (break $loop_3)
                          )

                          ;; while (...) { 
                          (block 
                            (setlocal $qq (loads.1.i32 (mul.i32 
                                  (add.i32 
                                    (const.i32 64)
                                    (getlocal $q0)
                                  )
                                  (const.i32 4)
                                ) ))
                            (setlocal $flag2 (eq.i32 
                                (getlocal $qq)
                                (const.i32 0)
                              ))

                            (if 
                              (getlocal $flag2)
                              (break $loop_3)
                            )
                            (stores.1.i32 
                              (mul.i32 
                                (add.i32 
                                  (const.i32 64)
                                  (getlocal $q0)
                                )
                                (const.i32 4)
                              )
                              (getlocal $q0)
                            )
                            (setlocal $flag3 (ges.i32 
                                (getlocal $q0)
                                (const.i32 3)
                              ))

                            (if 
                              (getlocal $flag3)
                              (block 
                                (setlocal $l (const.i32 1))
                                (setlocal $m (sub.i32 
                                    (getlocal $q0)
                                    (const.i32 1)
                                  ))

                                ;; do {
                                (label $loop_4099 
                                  (loop 
                                    (block 
                                      (setlocal $t (loads.1.i32 (mul.i32 
                                            (add.i32 
                                              (const.i32 64)
                                              (getlocal $l)
                                            )
                                            (const.i32 4)
                                          ) ))
                                      (stores.1.i32 
                                        (mul.i32 
                                          (add.i32 
                                            (const.i32 64)
                                            (getlocal $l)
                                          )
                                          (const.i32 4)
                                        )
                                        (loads.1.i32 (mul.i32 
                                            (add.i32 
                                              (const.i32 64)
                                              (getlocal $m)
                                            )
                                            (const.i32 4)
                                          ) )
                                      )
                                      (stores.1.i32 
                                        (mul.i32 
                                          (add.i32 
                                            (const.i32 64)
                                            (getlocal $m)
                                          )
                                          (const.i32 4)
                                        )
                                        (getlocal $t)
                                      )
                                      (setlocal $num (getlocal $l))
                                      (setlocal $l (add.i32 
                                          (getlocal $num)
                                          (const.i32 1)
                                        ))
                                      (setlocal $num (getlocal $m))
                                      (setlocal $m (sub.i32 
                                          (getlocal $num)
                                          (const.i32 1)
                                        ))
                                    )

                                    ;; do { ... } while ((@<var System.Int32 l> < @<var System.Int32 m>))

                                    (if 
                                      (lts.i32 
                                        (getlocal $l)
                                        (getlocal $m)
                                      )
                                      (nop)
                                      (break $loop_4099)
                                    )
                                  )
                                )
                              )
                            )
                            (setlocal $q0 (getlocal $qq))
                            (setlocal $num (getlocal $flips))
                            (setlocal $flips (add.i32 
                                (getlocal $num)
                                (const.i32 1)
                              ))
                          )
                        )
                      )
                      (setlocal $sum (add.i32 
                          (getlocal $sum)
                          (mul.i32 
                            (getlocal $sign)
                            (getlocal $flips)
                          )
                        ))
                      (setlocal $flag4 (gts.i32 
                          (getlocal $flips)
                          (getlocal $maxflips)
                        ))

                      (if 
                        (getlocal $flag4)
                        (setlocal $maxflips (getlocal $flips))
                      )
                    )
                  )
                  (setlocal $flag5 (eq.i32 
                      (getlocal $sign)
                      (const.i32 1)
                    ))

                  (if 
                    (getlocal $flag5)
                    (block 
                      (stores.1.i32 
                        (const.i32 132)
                        (loads.1.i32 (const.i32 128) )
                      )
                      (stores.1.i32 
                        (const.i32 128)
                        (loads.1.i32 (const.i32 132) )
                      )
                      (setlocal $sign (const.i32 -1))
                    )
                    (block 
                      (setlocal $t3 (loads.1.i32 (const.i32 132) ))
                      (stores.1.i32 
                        (const.i32 132)
                        (loads.1.i32 (const.i32 136) )
                      )
                      (stores.1.i32 
                        (const.i32 136)
                        (getlocal $t3)
                      )
                      (setlocal $sign (const.i32 1))

                      ;; for (var (@<var System.Int32 i2> = 2); ...)
                      (setlocal $i2 (const.i32 2))

                      (label $loop_5 
                        (loop 
                          ;; for (...; (@<var System.Int32 i2> < @<parameter System.Int32 n>); ...)

                          (if 
                            (lts.i32 
                              (getlocal $i2)
                              (getlocal $n)
                            )
                            (nop)
                            (break $loop_5)
                          )

                          ;; for (...) { 
                          (block 
                            (setlocal $sx (loads.1.i32 (mul.i32 
                                  (add.i32 
                                    (const.i32 96)
                                    (getlocal $i2)
                                  )
                                  (const.i32 4)
                                ) ))

                            (if 
                              (gts.i32 
                                (getlocal $sx)
                                (const.i32 0)
                              )
                              (block 
                                (stores.1.i32 
                                  (mul.i32 
                                    (add.i32 
                                      (const.i32 96)
                                      (getlocal $i2)
                                    )
                                    (const.i32 4)
                                  )
                                  (sub.i32 
                                    (getlocal $sx)
                                    (const.i32 1)
                                  )
                                )
                                (break $loop_5)
                              )
                            )
                            (setlocal $flag7 (eq.i32 
                                (getlocal $i2)
                                (sub.i32 
                                  (getlocal $n)
                                  (const.i32 1)
                                )
                              ))

                            (if 
                              (getlocal $flag7)
                              ;; goto Block_8
                              (block (setlocal $currentLabel_0 (const.i32 1)) (break $labelgroup_0_dispatch) )
                            )
                            (stores.1.i32 
                              (mul.i32 
                                (add.i32 
                                  (const.i32 96)
                                  (getlocal $i2)
                                )
                                (const.i32 4)
                              )
                              (getlocal $i2)
                            )
                            (setlocal $t3 (loads.1.i32 (const.i32 128) ))

                            ;; for (var (@<var System.Int32 j2> = 0); ...)
                            (setlocal $j2 (const.i32 0))

                            (label $loop_4100 
                              (loop 
                                ;; for (...; (@<var System.Int32 j2> <= @<var System.Int32 i2>); ...)

                                (if 
                                  (les.i32 
                                    (getlocal $j2)
                                    (getlocal $i2)
                                  )
                                  (nop)
                                  (break $loop_4100)
                                )

                                ;; for (...) { 
                                (block 
                                  (stores.1.i32 
                                    (mul.i32 
                                      (add.i32 
                                        (const.i32 32)
                                        (getlocal $j2)
                                      )
                                      (const.i32 4)
                                    )
                                    (loads.1.i32 (mul.i32 
                                        (add.i32 
                                          (const.i32 32)
                                          (add.i32 
                                            (getlocal $j2)
                                            (const.i32 1)
                                          )
                                        )
                                        (const.i32 4)
                                      ) )
                                  )
                                  (setlocal $num (getlocal $j2))
                                  (setlocal $j2 (add.i32 
                                      (getlocal $num)
                                      (const.i32 1)
                                    ))
                                )
                              )
                            )
                            (stores.1.i32 
                              (mul.i32 
                                (add.i32 
                                  (const.i32 32)
                                  (add.i32 
                                    (getlocal $i2)
                                    (const.i32 1)
                                  )
                                )
                                (const.i32 4)
                              )
                              (getlocal $t3)
                            )
                            (setlocal $num (getlocal $i2))
                            (setlocal $i2 (add.i32 
                                (getlocal $num)
                                (const.i32 1)
                              ))
                          )
                        )
                      )
                    )
                  )
                )
              )
            )
          )

        )
        ;; End Label $entry0

        ;; Begin Label Block_8
        (if (eq.i32 (getlocal $currentLabel_0) (const.i32 1)) 
          (block 
            (stores.1.i32 
              (const.i32 0)
              (getlocal $sum)
            )
            (stores.1.i32 
              (const.i32 4)
              (getlocal $maxflips)
            )
          )

        )
        ;; End Label Block_8

        ;; Fallthrough exit from labelgroup 0
        (break $labelgroup_0)
        )
      ))
    )

  )
  (func $Program_readI32
    (param $base i32) (param $offset i32) 
    (result i32)

    (return (loads.1.i32 (mul.i32 
          (add.i32 
            (getlocal $base)
            (getlocal $offset)
          )
          (const.i32 4)
        ) ))
  )

  (export "fannkuch" $Program_fannkuch)

  (export "readI32" $Program_readI32)

  (memory 4096 4096)

)

(invoke "fannkuch" (const.i32 7) )
(asserteq (invoke "readI32" (const.i32 0) (const.i32 0)  ) (const.i32 228) )
(asserteq (invoke "readI32" (const.i32 0) (const.i32 1)  ) (const.i32 16) )
