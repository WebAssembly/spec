<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modules &#8212; WebAssembly 3.0 (2025-09-19)</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=057308f9" />
    <script src="../_static/documentation_options.js?v=14242dd9"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"tex": {"maxBuffer": 30720, "macros": {"multicolumn": ["", 2]}}, "options": {"menuOptions": {"settings": {"enrich": false}}}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Binary Format" href="../binary/index.html" />
    <link rel="prev" title="Instructions" href="instructions.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/webassembly.png" alt="Logo of WebAssembly"/>
            </a></p><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syntax/index.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../valid/index.html">Validation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Execution</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="runtime.html">Runtime Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="numerics.html">Numerics</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="values.html">Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="instructions.html">Instructions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../binary/index.html">Binary Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../text/index.html">Text Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-types.html">Index of Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-instructions.html">Index of Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index-rules.html">Index of Semantic Rules</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="../genindex.html">Index</a></li>
    
    <li class="toctree-l1"><a href="../_download/WebAssembly.pdf">Download as PDF</a></li>
    
</ul>

<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="modules">
<h1>Modules<a class="headerlink" href="#modules" title="Link to this heading">¶</a></h1>
<p>For modules, the execution semantics primarily defines <a class="reference internal" href="#exec-instantiation"><span class="std std-ref">instantiation</span></a>, which <a class="reference internal" href="#alloc"><span class="std std-ref">allocates</span></a> instances for a module and its contained definitions, initializes <a class="reference internal" href="../syntax/modules.html#syntax-mem"><span class="std std-ref">memories</span></a> and <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">tables</span></a> from contained <a class="reference internal" href="../syntax/modules.html#syntax-data"><span class="std std-ref">data</span></a> and <a class="reference internal" href="../syntax/modules.html#syntax-elem"><span class="std std-ref">element</span></a> segments, and invokes the <a class="reference internal" href="../syntax/modules.html#syntax-start"><span class="std std-ref">start function</span></a> if present. It also includes <a class="reference internal" href="#exec-invocation"><span class="std std-ref">invocation</span></a> of exported functions.</p>
<section id="allocation">
<span id="alloc"></span><span id="index-0"></span><h2>Allocation<a class="headerlink" href="#allocation" title="Link to this heading">¶</a></h2>
<p>New instances of
<a class="reference internal" href="runtime.html#syntax-taginst"><span class="std std-ref">tags</span></a>,
<a class="reference internal" href="runtime.html#syntax-globalinst"><span class="std std-ref">globals</span></a>,
<a class="reference internal" href="runtime.html#syntax-meminst"><span class="std std-ref">memories</span></a>,
<a class="reference internal" href="runtime.html#syntax-tableinst"><span class="std std-ref">tables</span></a>,
<a class="reference internal" href="runtime.html#syntax-funcinst"><span class="std std-ref">functions</span></a>,
<a class="reference internal" href="runtime.html#syntax-datainst"><span class="std std-ref">data segments</span></a>, and
<a class="reference internal" href="runtime.html#syntax-eleminst"><span class="std std-ref">element segments</span></a>
are <em>allocated</em> in a <a class="reference internal" href="runtime.html#syntax-store"><span class="std std-ref">store</span></a> <span class="math notranslate nohighlight">\(s\)</span>, as defined by the following auxiliary functions.</p>
<section id="tags">
<span id="alloc-tag"></span><span id="index-1"></span><h3><a class="reference internal" href="runtime.html#syntax-taginst"><span class="std std-ref">Tags</span></a><a class="headerlink" href="#tags" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-tag-mathrm-alloctag-s-xref-syntax-types-syntax-tagtype-mathit-tagtype">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-tag}{\mathrm{alloctag}}}(s, {\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-tag-mathrm-alloctag-s-xref-syntax-types-syntax-tagtype-mathit-tagtype" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-taginst}{\mathit{taginst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-taginst"><span class="std std-ref">tag instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-taginst}{\mathsf{type}}~{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{tags}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-taginst}{\mathit{taginst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{tags}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-tag}{\mathrm{alloctag}}}(s, {\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{tags}}~{\href{../exec/runtime.html#syntax-taginst}{\mathit{taginst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{tags}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-taginst}{\mathit{taginst}}} = \{ \href{../exec/runtime.html#syntax-taginst}{\mathsf{type}}~{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="globals">
<span id="alloc-global"></span><span id="index-2"></span><h3><a class="reference internal" href="runtime.html#syntax-globalinst"><span class="std std-ref">Globals</span></a><a class="headerlink" href="#globals" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-global-mathrm-allocglobal-s-xref-syntax-types-syntax-globaltype-mathit-globaltype-xref-exec-runtime-syntax-val-mathit-val">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}}(s, {\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}, {\href{../exec/runtime.html#syntax-val}{\mathit{val}}})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-global-mathrm-allocglobal-s-xref-syntax-types-syntax-globaltype-mathit-globaltype-xref-exec-runtime-syntax-val-mathit-val" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-globalinst"><span class="std std-ref">global instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-globalinst}{\mathsf{type}}~{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}},\;\allowbreak \href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}}~{\href{../exec/runtime.html#syntax-val}{\mathit{val}}} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}}(s, {\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}, {\href{../exec/runtime.html#syntax-val}{\mathit{val}}}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{globals}}~{\href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-globalinst}{\mathit{globalinst}}} = \{ \href{../exec/runtime.html#syntax-globalinst}{\mathsf{type}}~{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}},\;\allowbreak \href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}}~{\href{../exec/runtime.html#syntax-val}{\mathit{val}}} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="memories">
<span id="alloc-mem"></span><span id="index-3"></span><h3><a class="reference internal" href="runtime.html#syntax-meminst"><span class="std std-ref">Memories</span></a><a class="headerlink" href="#memories" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-mem-mathrm-allocmem-s-mathit-at-i-xref-syntax-types-syntax-limits-j-xref-syntax-types-syntax-memtype-mathsf-page">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-mem}{\mathrm{allocmem}}}(s, {\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-mem-mathrm-allocmem-s-mathit-at-i-xref-syntax-types-syntax-limits-j-xref-syntax-types-syntax-memtype-mathsf-page" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-meminst"><span class="std std-ref">memory instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}),\;\allowbreak \href{../exec/runtime.html#syntax-meminst}{\mathsf{bytes}}~{\mathtt{0x00}^{i \cdot 64 \, {\mathrm{Ki}}}} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-mem}{\mathrm{allocmem}}}(s, {\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{mems}}~{\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}} = \{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}),\;\allowbreak \href{../exec/runtime.html#syntax-meminst}{\mathsf{bytes}}~{(\mathtt{0x00})^{i \cdot 64 \, {\mathrm{Ki}}}} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="tables">
<span id="alloc-table"></span><span id="index-4"></span><h3><a class="reference internal" href="runtime.html#syntax-tableinst"><span class="std std-ref">Tables</span></a><a class="headerlink" href="#tables" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-table-mathrm-alloctable-s-mathit-at-i-xref-syntax-types-syntax-limits-j-mathit-rt-xref-exec-runtime-syntax-ref-mathit-ref">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-table}{\mathrm{alloctable}}}(s, {\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}, {\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-table-mathrm-alloctable-s-mathit-at-i-xref-syntax-types-syntax-limits-j-mathit-rt-xref-exec-runtime-syntax-ref-mathit-ref" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-tableinst"><span class="std std-ref">table instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}),\;\allowbreak \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}^{i}} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-table}{\mathrm{alloctable}}}(s, {\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}, {\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{tables}}~{\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}} = \{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}),\;\allowbreak \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}^{i}} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="functions">
<span id="alloc-func"></span><span id="index-5"></span><h3><a class="reference internal" href="runtime.html#syntax-funcinst"><span class="std std-ref">Functions</span></a><a class="headerlink" href="#functions" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-func-mathrm-allocfunc-s-xref-valid-conventions-syntax-deftype-mathit-deftype-xref-exec-runtime-syntax-funcinst-mathit-code-xref-exec-runtime-syntax-moduleinst-mathit-moduleinst">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-func}{\mathrm{allocfunc}}}(s, {\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}}, {{\href{../exec/runtime.html#syntax-funcinst}{\mathit{code}}}}, {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-func-mathrm-allocfunc-s-xref-valid-conventions-syntax-deftype-mathit-deftype-xref-exec-runtime-syntax-funcinst-mathit-code-xref-exec-runtime-syntax-moduleinst-mathit-moduleinst" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-funcinst"><span class="std std-ref">function instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}~{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}},\;\allowbreak \href{../exec/runtime.html#syntax-funcinst}{\mathsf{module}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}},\;\allowbreak \href{../exec/runtime.html#syntax-funcinst}{\mathsf{code}}~{{\href{../exec/runtime.html#syntax-funcinst}{\mathit{code}}}} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-func}{\mathrm{allocfunc}}}(s, {\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}}, {{\href{../exec/runtime.html#syntax-funcinst}{\mathit{code}}}}, {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}~{\href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}} = \{ \href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}~{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}},\;\allowbreak \href{../exec/runtime.html#syntax-funcinst}{\mathsf{module}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}},\;\allowbreak \href{../exec/runtime.html#syntax-funcinst}{\mathsf{code}}~{{\href{../exec/runtime.html#syntax-funcinst}{\mathit{code}}}} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="data-segments">
<span id="alloc-data"></span><span id="index-6"></span><h3><a class="reference internal" href="runtime.html#syntax-datainst"><span class="std std-ref">Data segments</span></a><a class="headerlink" href="#data-segments" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-data-mathrm-allocdata-s-xref-valid-modules-valid-data-mathsf-ok-xref-syntax-values-syntax-byte-mathit-byte-ast">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-data}{\mathrm{allocdata}}}(s, \href{../valid/modules.html#valid-data}{\mathsf{ok}}, {{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-data-mathrm-allocdata-s-xref-valid-modules-valid-data-mathsf-ok-xref-syntax-values-syntax-byte-mathit-byte-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-datainst}{\mathit{datainst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-datainst"><span class="std std-ref">data instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-datainst}{\mathsf{bytes}}~{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{datas}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-datainst}{\mathit{datainst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{datas}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-data}{\mathrm{allocdata}}}(s, \href{../valid/modules.html#valid-data}{\mathsf{ok}}, {{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{datas}}~{\href{../exec/runtime.html#syntax-datainst}{\mathit{datainst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{datas}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-datainst}{\mathit{datainst}}} = \{ \href{../exec/runtime.html#syntax-datainst}{\mathsf{bytes}}~{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="element-segments">
<span id="alloc-elem"></span><span id="index-7"></span><h3><a class="reference internal" href="runtime.html#syntax-eleminst"><span class="std std-ref">Element segments</span></a><a class="headerlink" href="#element-segments" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-elem-mathrm-allocelem-s-xref-syntax-types-syntax-elemtype-mathit-elemtype-xref-exec-runtime-syntax-ref-mathit-ref-ast">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-elem}{\mathrm{allocelem}}}(s, {\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}^\ast})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-elem-mathrm-allocelem-s-xref-syntax-types-syntax-elemtype-mathit-elemtype-xref-exec-runtime-syntax-ref-mathit-ref-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-eleminst}{\mathit{eleminst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-eleminst"><span class="std std-ref">element instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-eleminst}{\mathsf{type}}~{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}},\;\allowbreak \href{../exec/runtime.html#syntax-eleminst}{\mathsf{elem}}~{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}^\ast} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be the length of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{elems}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-eleminst}{\mathit{eleminst}}}\)</span> to <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{elems}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(a\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-elem}{\mathrm{allocelem}}}(s, {\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}^\ast}) &amp; = &amp; (s \oplus \{ \href{../exec/runtime.html#syntax-store}{\mathsf{elems}}~{\href{../exec/runtime.html#syntax-eleminst}{\mathit{eleminst}}} \}, {|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{elems}}|}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad \mbox{if}~ {\href{../exec/runtime.html#syntax-eleminst}{\mathit{eleminst}}} = \{ \href{../exec/runtime.html#syntax-eleminst}{\mathsf{type}}~{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}},\;\allowbreak \href{../exec/runtime.html#syntax-eleminst}{\mathsf{elem}}~{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}^\ast} \}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="growing-memories">
<span id="grow-mem"></span><span id="index-8"></span><h3>Growing <a class="reference internal" href="runtime.html#syntax-meminst"><span class="std std-ref">memories</span></a><a class="headerlink" href="#growing-memories" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-grow-mem-mathrm-growmem-xref-exec-runtime-syntax-meminst-mathit-meminst-n">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#grow-mem}{\mathrm{growmem}}}({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}}, n)\)</span><a class="headerlink" href="#xref-exec-modules-grow-mem-mathrm-growmem-xref-exec-runtime-syntax-meminst-mathit-meminst-n" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}),\;\allowbreak \href{../exec/runtime.html#syntax-meminst}{\mathsf{bytes}}~{b^\ast} \}\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({i'}\)</span> be <span class="math notranslate nohighlight">\({|{b^\ast}|} / (64 \, {\mathrm{Ki}}) + n\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\({({i'} \leq j)^?}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}'}\)</span> be the <a class="reference internal" href="runtime.html#syntax-meminst"><span class="std std-ref">memory instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~({\mathit{at}}~{}[ {i'} \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}),\;\allowbreak \href{../exec/runtime.html#syntax-meminst}{\mathsf{bytes}}~{b^\ast}~{\mathtt{0x00}^{n \cdot 64 \, {\mathrm{Ki}}}} \}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}'}\)</span>.</p></li>
</ol>
</li>
<li><p>Fail.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#grow-mem}{\mathrm{growmem}}}({\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}}, n) &amp; = &amp; {\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}'} &amp; \quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ {\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}} = \{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}),\; \href{../exec/runtime.html#syntax-meminst}{\mathsf{bytes}}~{b^\ast} \} \\
{\land}~ {\href{../exec/runtime.html#syntax-meminst}{\mathit{meminst}}'} = \{ \href{../exec/runtime.html#syntax-meminst}{\mathsf{type}}~({\mathit{at}}~{}[ {i'} \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~\href{../syntax/types.html#syntax-memtype}{\mathsf{page}}),\; \href{../exec/runtime.html#syntax-meminst}{\mathsf{bytes}}~{b^\ast}~{(\mathtt{0x00})^{n \cdot 64 \, {\mathrm{Ki}}}} \} \\
{\land}~ {i'} = {|{b^\ast}|} / (64 \, {\mathrm{Ki}}) + n \\
{\land}~ ({i'} \leq j)^? \\
\end{array} \\
\end{array}\end{split}\]</div>
</section>
<section id="growing-tables">
<span id="grow-table"></span><span id="index-9"></span><h3>Growing <a class="reference internal" href="runtime.html#syntax-tableinst"><span class="std std-ref">tables</span></a><a class="headerlink" href="#growing-tables" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-grow-table-mathrm-growtable-xref-exec-runtime-syntax-tableinst-mathit-tableinst-n-r">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#grow-table}{\mathrm{growtable}}}({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}}, n, r)\)</span><a class="headerlink" href="#xref-exec-modules-grow-table-mathrm-growtable-xref-exec-runtime-syntax-tableinst-mathit-tableinst-n-r" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}),\;\allowbreak \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~{{r'}^\ast} \}\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({i'}\)</span> be <span class="math notranslate nohighlight">\({|{{r'}^\ast}|} + n\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\({({i'} \leq j)^?}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}'}\)</span> be the <a class="reference internal" href="runtime.html#syntax-tableinst"><span class="std std-ref">table instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{type}}~({\mathit{at}}~{}[ {i'} \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}),\;\allowbreak \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~{{r'}^\ast}~{r^{n}} \}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}'}\)</span>.</p></li>
</ol>
</li>
<li><p>Fail.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#grow-table}{\mathrm{growtable}}}({\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}}, n, r) &amp; = &amp; {\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}'} &amp; \quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ {\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}} = \{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{type}}~({\mathit{at}}~{}[ i \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}),\; \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~{{r'}^\ast} \} \\
{\land}~ {\href{../exec/runtime.html#syntax-tableinst}{\mathit{tableinst}}'} = \{ \href{../exec/runtime.html#syntax-tableinst}{\mathsf{type}}~({\mathit{at}}~{}[ {i'} \href{../syntax/types.html#syntax-limits}{\,{..}\,} {j^?} ]~{\mathit{rt}}),\; \href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}~{{r'}^\ast}~{r^{n}} \} \\
{\land}~ {i'} = {|{{r'}^\ast}|} + n \\
{\land}~ ({i'} \leq j)^? \\
\end{array} \\
\end{array}\end{split}\]</div>
</section>
<section id="alloc-module">
<span id="index-10"></span><span id="id1"></span><h3><a class="reference internal" href="runtime.html#syntax-moduleinst"><span class="std std-ref">Modules</span></a><a class="headerlink" href="#alloc-module" title="Link to this heading">¶</a></h3>
</section>
<section id="xref-exec-modules-alloc-module-mathrm-allocmodule-s-xref-syntax-modules-syntax-module-mathit-module-xref-exec-runtime-syntax-externaddr-mathit-externaddr-ast-xref-exec-runtime-syntax-val-mathit-val-mathsf-g-ast-xref-exec-runtime-syntax-ref-mathit-ref-mathsf-t-ast-xref-exec-runtime-syntax-ref-mathit-ref-mathsf-e-ast-ast">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-module}{\mathrm{allocmodule}}}(s, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}}, {{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}, {{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}^\ast})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-module-mathrm-allocmodule-s-xref-syntax-modules-syntax-module-mathit-module-xref-exec-runtime-syntax-externaddr-mathit-externaddr-ast-xref-exec-runtime-syntax-val-mathit-val-mathsf-g-ast-xref-exec-runtime-syntax-ref-mathit-ref-mathsf-t-ast-xref-exec-runtime-syntax-ref-mathit-ref-mathsf-e-ast-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-module}{\mathsf{module}}~{{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast}~{{\href{../syntax/modules.html#syntax-import}{\mathit{import}}}^\ast}~{{\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}^\ast}~{{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast}~{{\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}^\ast}~{{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast}~{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}~{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}~{{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}~{{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?}~{{\href{../syntax/modules.html#syntax-export}{\mathit{export}}}^\ast})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-module}{\mathit{module}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{aa}}_{\mathsf{i}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathrm{tags}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ga}}_{\mathsf{i}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathrm{globals}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{fa}}_{\mathsf{i}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathrm{funcs}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ma}}_{\mathsf{i}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathrm{mems}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ta}}_{\mathsf{i}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathrm{tables}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{fa}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}|} + i_{\mathsf{f}}\)</span> for all <span class="math notranslate nohighlight">\(i_{\mathsf{f}}\)</span> from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\({|{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}|} - 1\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}^\ast}\)</span> be the tag type sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-tag}{\mathsf{tag}}~{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}^\ast}\)</span> be the byte sequence sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-data}{\mathit{data}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-data}{\mathsf{data}}~{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}~{\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-data}{\mathit{data}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}\)</span> to <span class="math notranslate nohighlight">\({{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}\)</span> be the global type sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-global}{\mathit{global}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-global}{\mathsf{global}}~{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-global}{\mathit{global}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}^\ast}\)</span> be the table type sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-table}{\mathit{table}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-table}{\mathsf{table}}~{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-table}{\mathit{table}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}^\ast}\)</span> be the memory type sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-mem}{\mathsf{memory}}~{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{dt}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast})}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}^\ast}\)</span> be the reference type sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}~{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}~{\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}}^\ast}\)</span> be the expression sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}^\ast}\)</span> be the local sequence sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({x^\ast}\)</span> be the type index sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-func}{\mathit{func}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-func}{\mathsf{func}}~x~{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-func}{\mathit{func}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}}^\ast}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}\)</span> to <span class="math notranslate nohighlight">\({{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}^\ast}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\({x^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{aa}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{aa}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-tagaddr"><span class="std std-ref">tag address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-tag}{\mathrm{alloctag}}}(s, {{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{aa}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{aa}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ga}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}\)</span> and <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{ga}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-globaladdr"><span class="std std-ref">global address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}}(s, {{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}, {\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{ga}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{ga}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ma}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{ma}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-memaddr"><span class="std std-ref">memory address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-mem}{\mathrm{allocmem}}}(s, {{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{ma}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{ma}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ta}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}^\ast}\)</span> and <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{ta}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-tableaddr"><span class="std std-ref">table address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-table}{\mathrm{alloctable}}}(s, {{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}, {\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{ta}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{ta}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{xi}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-export}{\mathit{export}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-export}{\mathit{export}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{xi}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-exportinst"><span class="std std-ref">export instance</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, {\href{../syntax/modules.html#syntax-export}{\mathit{export}}})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{xi}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{xi}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{da}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}\)</span> in <span class="math notranslate nohighlight">\({{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{da}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-dataaddr"><span class="std std-ref">data address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-data}{\mathrm{allocdata}}}(s, \href{../valid/modules.html#valid-data}{\mathsf{ok}}, {{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{da}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{da}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{ea}}^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}^\ast}\)</span> and <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}\)</span> in <span class="math notranslate nohighlight">\({{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{ea}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-elemaddr"><span class="std std-ref">elem address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-elem}{\mathrm{allocelem}}}(s, {{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\mathit{ea}}\)</span> to <span class="math notranslate nohighlight">\({{\mathit{ea}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-moduleinst"><span class="std std-ref">module instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{types}}~{{\mathit{dt}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tags}}~{{\mathit{aa}}_{\mathsf{i}}^\ast}~{{\mathit{aa}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}~{{\mathit{ga}}_{\mathsf{i}}^\ast}~{{\mathit{ga}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{mems}}~{{\mathit{ma}}_{\mathsf{i}}^\ast}~{{\mathit{ma}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tables}}~{{\mathit{ta}}_{\mathsf{i}}^\ast}~{{\mathit{ta}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}~{{\mathit{fa}}_{\mathsf{i}}^\ast}~{{\mathit{fa}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{datas}}~{{\mathit{da}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{elems}}~{{\mathit{ea}}^\ast},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{exports}}~{{\mathit{xi}}^\ast} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}_0^\ast}\)</span> be <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}}^\ast}\)</span> and <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}\)</span> in <span class="math notranslate nohighlight">\({{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}^\ast}\)</span> and <span class="math notranslate nohighlight">\(x\)</span> in <span class="math notranslate nohighlight">\({x^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}_0\)</span> be the <a class="reference internal" href="runtime.html#syntax-funcaddr"><span class="std std-ref">function address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-func}{\mathrm{allocfunc}}}(s, {{\mathit{dt}}^\ast}{}[x], \href{../syntax/modules.html#syntax-func}{\mathsf{func}}~x~{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}}, {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}_0\)</span> to <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}_0^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Assert: Due to validation, <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}_0^\ast} = {{\mathit{fa}}^\ast}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-module}{\mathrm{allocmodule}}}(s, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}}, {{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}, {({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast})^\ast}) &amp; = &amp; (s_7, {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ {\href{../syntax/modules.html#syntax-module}{\mathit{module}}} = \href{../syntax/modules.html#syntax-module}{\mathsf{module}}~{{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast}~{{\href{../syntax/modules.html#syntax-import}{\mathit{import}}}^\ast}~{{\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}^\ast}~{{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast}~{{\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}^\ast}~{{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast}~{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}~{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}~{{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}~{{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?}~{{\href{../syntax/modules.html#syntax-export}{\mathit{export}}}^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}^\ast} = {(\href{../syntax/modules.html#syntax-tag}{\mathsf{tag}}~{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast} = {(\href{../syntax/modules.html#syntax-global}{\mathsf{global}}~{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}^\ast} = {(\href{../syntax/modules.html#syntax-mem}{\mathsf{memory}}~{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast} = {(\href{../syntax/modules.html#syntax-table}{\mathsf{table}}~{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast} = {(\href{../syntax/modules.html#syntax-func}{\mathsf{func}}~x~{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast} = {(\href{../syntax/modules.html#syntax-data}{\mathsf{data}}~{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}~{\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast} = {(\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}~{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}~{\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}})^\ast} \\
{\land}~ {{\mathit{aa}}_{\mathsf{i}}^\ast} = {\href{../exec/runtime.html#syntax-externaddr}{\mathrm{tags}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}) \\
{\land}~ {{\mathit{ga}}_{\mathsf{i}}^\ast} = {\href{../exec/runtime.html#syntax-externaddr}{\mathrm{globals}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}) \\
{\land}~ {{\mathit{ma}}_{\mathsf{i}}^\ast} = {\href{../exec/runtime.html#syntax-externaddr}{\mathrm{mems}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}) \\
{\land}~ {{\mathit{ta}}_{\mathsf{i}}^\ast} = {\href{../exec/runtime.html#syntax-externaddr}{\mathrm{tables}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}) \\
{\land}~ {{\mathit{fa}}_{\mathsf{i}}^\ast} = {\href{../exec/runtime.html#syntax-externaddr}{\mathrm{funcs}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}) \\
{\land}~ {{\mathit{dt}}^\ast} = {{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast})} \\
{\land}~ {{\mathit{fa}}^\ast} = {({|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}|} + i_{\mathsf{f}})^{i_{\mathsf{f}}&lt;{|{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}|}}} \\
{\land}~ (s_1, {{\mathit{aa}}^\ast}) = {{{\href{../exec/modules.html#alloc-tag}{\mathrm{alloctag}}}^\ast}}{(s, {{{\href{../syntax/types.html#syntax-tagtype}{\mathit{tagtype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}^\ast})} \\
{\land}~ (s_2, {{\mathit{ga}}^\ast}) = {{{\href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}}^\ast}}{(s_1, {{{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}^\ast}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast})} \\
{\land}~ (s_3, {{\mathit{ma}}^\ast}) = {{{\href{../exec/modules.html#alloc-mem}{\mathrm{allocmem}}}^\ast}}{(s_2, {{{\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}^\ast})} \\
{\land}~ (s_4, {{\mathit{ta}}^\ast}) = {{{\href{../exec/modules.html#alloc-table}{\mathrm{alloctable}}}^\ast}}{(s_3, {{{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}^\ast}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast})} \\
{\land}~ (s_5, {{\mathit{da}}^\ast}) = {{{\href{../exec/modules.html#alloc-data}{\mathrm{allocdata}}}^\ast}}{(s_4, {\href{../valid/modules.html#valid-data}{\mathsf{ok}}^{{|{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}|}}}, {({{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast})^\ast})} \\
{\land}~ (s_6, {{\mathit{ea}}^\ast}) = {{{\href{../exec/modules.html#alloc-elem}{\mathrm{allocelem}}}^\ast}}{(s_5, {{{\href{../syntax/types.html#syntax-elemtype}{\mathit{elemtype}}}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\mathit{dt}}^\ast} ]}^\ast}, {({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast})^\ast})} \\
{\land}~ (s_7, {{\mathit{fa}}^\ast}) = {{{\href{../exec/modules.html#alloc-func}{\mathrm{allocfunc}}}^\ast}}{(s_6, {{{\mathit{dt}}^\ast}{}[x]^\ast}, {(\href{../syntax/modules.html#syntax-func}{\mathsf{func}}~x~{{\href{../syntax/modules.html#syntax-local}{\mathit{local}}}^\ast}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{f}})^\ast}, {{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}^{{|{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}|}}})} \\
{\land}~ {{\mathit{xi}}^\ast} = {{{\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}^\ast}}{(\{ \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tags}}~{{\mathit{aa}}_{\mathsf{i}}^\ast}~{{\mathit{aa}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}~{{\mathit{ga}}_{\mathsf{i}}^\ast}~{{\mathit{ga}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{mems}}~{{\mathit{ma}}_{\mathsf{i}}^\ast}~{{\mathit{ma}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tables}}~{{\mathit{ta}}_{\mathsf{i}}^\ast}~{{\mathit{ta}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}~{{\mathit{fa}}_{\mathsf{i}}^\ast}~{{\mathit{fa}}^\ast} \}, {{\href{../syntax/modules.html#syntax-export}{\mathit{export}}}^\ast})} \\
{\land}~ {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}} = \{ \begin{array}[t]{&#64;{}l&#64;{}}
\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{types}}~{{\mathit{dt}}^\ast},\; \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tags}}~{{\mathit{aa}}_{\mathsf{i}}^\ast}~{{\mathit{aa}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}~{{\mathit{ga}}_{\mathsf{i}}^\ast}~{{\mathit{ga}}^\ast},\; \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{mems}}~{{\mathit{ma}}_{\mathsf{i}}^\ast}~{{\mathit{ma}}^\ast},\; \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tables}}~{{\mathit{ta}}_{\mathsf{i}}^\ast}~{{\mathit{ta}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}~{{\mathit{fa}}_{\mathsf{i}}^\ast}~{{\mathit{fa}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{datas}}~{{\mathit{da}}^\ast},\; \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{elems}}~{{\mathit{ea}}^\ast},\; \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{exports}}~{{\mathit{xi}}^\ast} \}\end{array} \\
\end{array}
} \\
\end{array}\end{split}\]</div>
<p>Here, the notation <span class="math notranslate nohighlight">\(\mathrm{allocx}^\ast\)</span> is shorthand for multiple <a class="reference internal" href="#alloc"><span class="std std-ref">allocations</span></a> of object kind <span class="math notranslate nohighlight">\(X\)</span>, defined as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{{{\mathrm{allocX}}^\ast}}{(s, \epsilon, \epsilon)} &amp; = &amp; (s, \epsilon) \\
{{{\mathrm{allocX}}^\ast}}{(s, X~{{X'}^\ast}, Y~{{Y'}^\ast})} &amp; = &amp; (s_2, a~{{a'}^\ast}) &amp; \quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ (s_1, a) = {\mathrm{allocX}}(X, Y, s, X, Y) \\
{\land}~ (s_2, {{a'}^\ast}) = {{{\mathrm{allocX}}^\ast}}{(s_1, {{X'}^\ast}, {{Y'}^\ast})} \\
\end{array} \\
\end{array}\end{split}\]</div>
<p>For types, however, allocation is defined in terms of <a class="reference internal" href="../valid/conventions.html#aux-roll-rectype"><span class="std std-ref">rolling</span></a> and <a class="reference internal" href="../valid/conventions.html#notation-subst"><span class="std std-ref">substitution</span></a> of all preceding types to produce a list of <a class="reference internal" href="../valid/conventions.html#type-closed"><span class="std std-ref">closed</span></a> <a class="reference internal" href="../valid/conventions.html#syntax-deftype"><span class="std std-ref">defined types</span></a>:</p>
</section>
<section id="xref-exec-modules-alloc-type-mathrm-alloctype-ast-xref-syntax-types-syntax-rectype-mathit-type-ast">
<span id="alloc-type"></span><h3><span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}''}^\ast})}\)</span><a class="headerlink" href="#xref-exec-modules-alloc-type-mathrm-alloctype-ast-xref-syntax-types-syntax-rectype-mathit-type-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}''}^\ast} = \epsilon\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Return <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}'}^\ast}~{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}\)</span> be <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}''}^\ast}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-type}{\mathsf{type}}~{\href{../syntax/types.html#syntax-rectype}{\mathit{rectype}}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}'}^\ast})}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(x\)</span> be the length of <span class="math notranslate nohighlight">\({{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{{{{\href{../valid/conventions.html#aux-roll-deftype}{\mathrm{roll}}}}_{x}^\ast}}{({\href{../syntax/types.html#syntax-rectype}{\mathit{rectype}}})}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast} ]}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast}~{{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}}^\ast}\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{(\epsilon)} &amp; = &amp; \epsilon \\
{{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}'}^\ast}~{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}})} &amp; = &amp; {{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast}~{{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}}^\ast} &amp; \quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ {{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast} = {{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}'}^\ast})} \\
{\land}~ {\href{../syntax/types.html#syntax-rectype}{\mathit{type}}} = \href{../syntax/modules.html#syntax-type}{\mathsf{type}}~{\href{../syntax/types.html#syntax-rectype}{\mathit{rectype}}} \\
{\land}~ {{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}}^\ast} = {{{{{\href{../valid/conventions.html#aux-roll-deftype}{\mathrm{roll}}}}_{x}^\ast}}{({\href{../syntax/types.html#syntax-rectype}{\mathit{rectype}}})}}{{}[ {\href{../valid/conventions.html#notation-subst}{\mathrel{:=}}}\, {{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast} ]} \\
{\land}~ x = {|{{\href{../valid/conventions.html#syntax-deftype}{\mathit{deftype}}'}^\ast}|} \\
\end{array} \\
\end{array}\end{split}\]</div>
<p>Finally, export instances are produced with the help of the following definition:</p>
</section>
<section id="xref-exec-modules-alloc-export-mathrm-allocexport-xref-exec-runtime-syntax-moduleinst-mathit-moduleinst-xref-syntax-modules-syntax-export-mathsf-export-xref-syntax-values-syntax-name-mathit-name-xref-syntax-modules-syntax-externidx-mathit-externidx">
<span id="alloc-export"></span><h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, \href{../syntax/modules.html#syntax-export}{\mathsf{export}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}}~{\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}})\)</span><a class="headerlink" href="#xref-exec-modules-alloc-export-mathrm-allocexport-xref-exec-runtime-syntax-moduleinst-mathit-moduleinst-xref-syntax-modules-syntax-export-mathsf-export-xref-syntax-values-syntax-name-mathit-name-xref-syntax-modules-syntax-externidx-mathit-externidx" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-externidx}{\mathsf{tag}}~{\href{../syntax/modules.html#syntax-tagidx}{\mathit{tagidx}}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-externidx}{\mathsf{tag}}~x)\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{tag}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tags}}{}[x]) \}\)</span>.</p></li>
</ol>
</li>
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-externidx}{\mathsf{global}}~{\href{../syntax/modules.html#syntax-globalidx}{\mathit{globalidx}}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-externidx}{\mathsf{global}}~x)\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{global}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}{}[x]) \}\)</span>.</p></li>
</ol>
</li>
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-externidx}{\mathsf{memory}}~{\href{../syntax/modules.html#syntax-memidx}{\mathit{memidx}}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-externidx}{\mathsf{memory}}~x)\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{mem}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{mems}}{}[x]) \}\)</span>.</p></li>
</ol>
</li>
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-externidx}{\mathsf{table}}~{\href{../syntax/modules.html#syntax-tableidx}{\mathit{tableidx}}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-externidx}{\mathsf{table}}~x)\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{table}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tables}}{}[x]) \}\)</span>.</p></li>
</ol>
</li>
<li><p>Assert: Due to validation, <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-externidx}{\mathsf{func}}~{\href{../syntax/modules.html#syntax-funcidx}{\mathit{funcidx}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-externidx}{\mathsf{func}}~x)\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-externidx}{\mathit{externidx}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{func}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}{}[x]) \}\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, \href{../syntax/modules.html#syntax-export}{\mathsf{export}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}}~(\href{../syntax/modules.html#syntax-externidx}{\mathsf{tag}}~x)) &amp; = &amp; \{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{tag}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tags}}{}[x]) \} \\
{\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, \href{../syntax/modules.html#syntax-export}{\mathsf{export}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}}~(\href{../syntax/modules.html#syntax-externidx}{\mathsf{global}}~x)) &amp; = &amp; \{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{global}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}{}[x]) \} \\
{\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, \href{../syntax/modules.html#syntax-export}{\mathsf{export}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}}~(\href{../syntax/modules.html#syntax-externidx}{\mathsf{memory}}~x)) &amp; = &amp; \{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{mem}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{mems}}{}[x]) \} \\
{\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, \href{../syntax/modules.html#syntax-export}{\mathsf{export}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}}~(\href{../syntax/modules.html#syntax-externidx}{\mathsf{table}}~x)) &amp; = &amp; \{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{table}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{tables}}{}[x]) \} \\
{\href{../exec/modules.html#alloc-export}{\mathrm{allocexport}}}({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}, \href{../syntax/modules.html#syntax-export}{\mathsf{export}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}}~(\href{../syntax/modules.html#syntax-externidx}{\mathsf{func}}~x)) &amp; = &amp; \{ \href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}~{\href{../syntax/values.html#syntax-name}{\mathit{name}}},\;\allowbreak \href{../exec/runtime.html#syntax-exportinst}{\mathsf{addr}}~(\href{../exec/runtime.html#syntax-externaddr}{\mathsf{func}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}{}[x]) \} \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The definition of module allocation is mutually recursive with the allocation of its associated functions, because the resulting module instance is passed to the allocators as an argument, in order to form the necessary closures.
In an implementation, this recursion is easily unraveled by mutating one or the other in a secondary step.</p>
</div>
</section>
</section>
<section id="instantiation">
<span id="exec-instantiation"></span><span id="exec-module"></span><span id="index-11"></span><h2>Instantiation<a class="headerlink" href="#instantiation" title="Link to this heading">¶</a></h2>
<p>Given a <a class="reference internal" href="runtime.html#syntax-store"><span class="std std-ref">store</span></a> <span class="math notranslate nohighlight">\(s\)</span>, a <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-module}{\mathit{module}}}\)</span> is instantiated with a list of <a class="reference internal" href="runtime.html#syntax-externaddr"><span class="std std-ref">external addresses</span></a> <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}\)</span> supplying the required imports as follows.</p>
<p>Instantiation checks that the module is <a class="reference internal" href="../valid/index.html#valid"><span class="std std-ref">valid</span></a> and the provided imports <a class="reference internal" href="../valid/matching.html#match-externtype"><span class="std std-ref">match</span></a> the declared types,
and may <em>fail</em> with an error otherwise.
Instantiation can also result in an <a class="reference internal" href="../syntax/instructions.html#exception"><span class="std std-ref">exception</span></a> or <a class="reference internal" href="../intro/overview.html#trap"><span class="std std-ref">trap</span></a> when initializing a <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">table</span></a> or <a class="reference internal" href="../syntax/modules.html#syntax-mem"><span class="std std-ref">memory</span></a> from an <a class="reference internal" href="../syntax/modules.html#syntax-data"><span class="std std-ref">active segment</span></a> or when executing the <a class="reference internal" href="../syntax/modules.html#syntax-start"><span class="std std-ref">start</span></a> function.
It is up to the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> to define how such conditions are reported.</p>
<section id="xref-exec-modules-exec-instantiation-mathrm-instantiate-s-xref-syntax-modules-syntax-module-mathit-module-xref-exec-runtime-syntax-externaddr-mathit-externaddr-ast">
<span id="exec-initvals"></span><h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#exec-instantiation}{\mathrm{instantiate}}}(s, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}}, {{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})\)</span><a class="headerlink" href="#xref-exec-modules-exec-instantiation-mathrm-instantiate-s-xref-syntax-modules-syntax-module-mathit-module-xref-exec-runtime-syntax-externaddr-mathit-externaddr-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-module}{\mathit{module}}}\)</span> is not <a class="reference internal" href="../valid/modules.html#valid-module"><span class="std std-ref">valid</span></a>, then:</p>
<ol class="loweralpha simple">
<li><p>Fail.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\mathit{xt}}_{\mathsf{i}}^\ast}~\mathrel{\href{../valid/modules.html#syntax-moduletype}{\rightarrow}}~{{\mathit{xt}}_{\mathsf{e}}^\ast}\)</span> be the destructuring of the type of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-module}{\mathit{module}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-module}{\mathsf{module}}~{{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast}~{{\href{../syntax/modules.html#syntax-import}{\mathit{import}}}^\ast}~{{\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}^\ast}~{{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast}~{{\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}^\ast}~{{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast}~{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}~{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}~{{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}~{{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?}~{{\href{../syntax/modules.html#syntax-export}{\mathit{export}}}^\ast})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-module}{\mathit{module}}}\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\({|{{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}|} \neq {|{{\mathit{xt}}_{\mathsf{i}}^\ast}|}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Fail.</p></li>
</ol>
</li>
<li><p>For all <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}\)</span>, and corresponding <span class="math notranslate nohighlight">\({\mathit{xt}}_{\mathsf{i}}\)</span> in <span class="math notranslate nohighlight">\({{\mathit{xt}}_{\mathsf{i}}^\ast}\)</span>:</p>
<ol class="loweralpha simple">
<li><p>If <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}\)</span> is not <a class="reference internal" href="values.html#valid-val"><span class="std std-ref">valid</span></a> with type <span class="math notranslate nohighlight">\({\mathit{xt}}_{\mathsf{i}}\)</span>, then:</p>
<ol class="arabic simple">
<li><p>Fail.</p></li>
</ol>
</li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{d}}^\ast}\)</span> be the <a class="reference internal" href="../syntax/conventions.html#notation-concat"><span class="std std-ref">concatenation</span></a> of <span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#aux-rundata}{\mathrm{rundata}}}}_{i_{\mathsf{d}}}({{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}{}[i_{\mathsf{d}}])^{i_{\mathsf{d}}&lt;{|{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}|}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{e}}^\ast}\)</span> be the <a class="reference internal" href="../syntax/conventions.html#notation-concat"><span class="std std-ref">concatenation</span></a> of <span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#aux-runelem}{\mathrm{runelem}}}}_{i_{\mathsf{e}}}({{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}{}[i_{\mathsf{e}}])^{i_{\mathsf{e}}&lt;{|{{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}|}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}_0\)</span> be the <a class="reference internal" href="runtime.html#syntax-moduleinst"><span class="std std-ref">module instance</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{types}}~{{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast})},\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}~{\href{../exec/runtime.html#syntax-externaddr}{\mathrm{globals}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}),\;\allowbreak \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}~{\href{../exec/runtime.html#syntax-externaddr}{\mathrm{funcs}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})~{({|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}|} + i_{\mathsf{f}})^{i_{\mathsf{f}}&lt;{|{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}|}}} \}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}}^\ast}\)</span> be the expression sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-table}{\mathit{table}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-table}{\mathsf{table}}~{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-table}{\mathit{table}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}}^\ast}\)</span> be the expression sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}\)</span> be the global type sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-global}{\mathit{global}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-global}{\mathsf{global}}~{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-global}{\mathit{global}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}}^\ast}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}^\ast}\)</span> be the expression sequence sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\href{../syntax/types.html#syntax-reftype}{\mathit{reftype}}}~{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}~{\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}\)</span> to <span class="math notranslate nohighlight">\({{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\(z\)</span> be the <a class="reference internal" href="runtime.html#syntax-state"><span class="std std-ref">state</span></a> <span class="math notranslate nohighlight">\((s, \{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}_0 \})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(F\)</span> be the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> <span class="math notranslate nohighlight">\(z{.}\href{../exec/runtime.html#syntax-store}{\mathsf{frame}}\)</span>.</p></li>
<li><p>Push the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> <span class="math notranslate nohighlight">\(F\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{(z, {{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}, {{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}}^\ast})}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}\)</span> be the reference value sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}\)</span> be the result of <a class="reference internal" href="instructions.html#exec-expr"><span class="std std-ref">evaluating</span></a> <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}}\)</span> with state <span class="math notranslate nohighlight">\(z\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\({{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}^\ast}\)</span> be the reference value sequence sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}\)</span> in <span class="math notranslate nohighlight">\({{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}^\ast}\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}\)</span> be the reference value sequence <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
<li><p>For each <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}\)</span>, do:</p>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}\)</span> be the result of <a class="reference internal" href="instructions.html#exec-expr"><span class="std std-ref">evaluating</span></a> <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}\)</span> with state <span class="math notranslate nohighlight">\(z\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}\)</span> to <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Append <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}\)</span> to <span class="math notranslate nohighlight">\({{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}^\ast}\)</span>.</p></li>
</ol>
</li>
<li><p>Pop the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> from the stack.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-module}{\mathrm{allocmodule}}}(s, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}}, {{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}, {{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}^\ast})\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({F'}\)</span> be the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}} \}\)</span>.</p></li>
<li><p>Push the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> <span class="math notranslate nohighlight">\({F'}\)</span>.</p></li>
<li><p>Execute the sequence <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{e}}^\ast}\)</span>.</p></li>
<li><p>Execute the sequence <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{d}}^\ast}\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?}\)</span> is defined, then:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-start}{\mathsf{start}}~x)\)</span> be <span class="math notranslate nohighlight">\({{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{s}}\)</span> be the <a class="reference internal" href="../syntax/instructions.html#syntax-instr"><span class="std std-ref">instruction</span></a> <span class="math notranslate nohighlight">\((\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{call}}~x)\)</span>.</p></li>
<li><p>Execute the instruction <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{s}}\)</span>.</p></li>
</ol>
</li>
<li><p>Pop the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> from the stack.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#exec-instantiation}{\mathrm{instantiate}}}(s, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}}, {{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}) &amp; = &amp; {s'} ; \{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}} \} ; {{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{e}}^\ast}~{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{d}}^\ast}~{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{s}}^?} &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ {\href{../valid/modules.html#valid-module}{\vdash}}\, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}} : {{\mathit{xt}}_{\mathsf{i}}^\ast} \mathrel{\href{../valid/modules.html#syntax-moduletype}{\rightarrow}} {{\mathit{xt}}_{\mathsf{e}}^\ast} \\
{\land}~ (s \href{../exec/values.html#valid-externaddr}{\vdash} {\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}} : {\mathit{xt}}_{\mathsf{i}})^\ast \\[0.8ex]
{\land}~ {\href{../syntax/modules.html#syntax-module}{\mathit{module}}} = \href{../syntax/modules.html#syntax-module}{\mathsf{module}}~{{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast}~{{\href{../syntax/modules.html#syntax-import}{\mathit{import}}}^\ast}~{{\href{../syntax/modules.html#syntax-tag}{\mathit{tag}}}^\ast}~{{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast}~{{\href{../syntax/modules.html#syntax-mem}{\mathit{mem}}}^\ast}~{{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast}~{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}~{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}~{{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}~{{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?}~{{\href{../syntax/modules.html#syntax-export}{\mathit{export}}}^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-global}{\mathit{global}}}^\ast} = {(\href{../syntax/modules.html#syntax-global}{\mathsf{global}}~{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-table}{\mathit{table}}}^\ast} = {(\href{../syntax/modules.html#syntax-table}{\mathsf{table}}~{\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast} = {(\href{../syntax/modules.html#syntax-data}{\mathsf{data}}~{{\href{../syntax/values.html#syntax-byte}{\mathit{byte}}}^\ast}~{\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast} = {(\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\href{../syntax/types.html#syntax-reftype}{\mathit{reftype}}}~{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}}^\ast}~{\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}})^\ast} \\
{\land}~ {{\href{../syntax/modules.html#syntax-start}{\mathit{start}}}^?} = {(\href{../syntax/modules.html#syntax-start}{\mathsf{start}}~x)^?} \\
{\land}~ {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}_0 = \{ \begin{array}[t]{&#64;{}l&#64;{}}
\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{types}}~{{{\href{../exec/modules.html#alloc-type}{\mathrm{alloctype}}}^\ast}}{({{\href{../syntax/types.html#syntax-rectype}{\mathit{type}}}^\ast})},\; \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}~{\href{../exec/runtime.html#syntax-externaddr}{\mathrm{globals}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}),\; \\
  \href{../exec/runtime.html#syntax-moduleinst}{\mathsf{funcs}}~{\href{../exec/runtime.html#syntax-externaddr}{\mathrm{funcs}}}({{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast})~{({|s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}|} + i_{\mathsf{f}})^{i_{\mathsf{f}}&lt;{|{{\href{../syntax/modules.html#syntax-func}{\mathit{func}}}^\ast}|}}} \}\end{array} \\
{\land}~ z = s ; \{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~{\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}_0 \} \\
{\land}~ ({z'}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}) = {{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{(z, {{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}, {{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{g}}^\ast})} \\
{\land}~ ({z'} ; {\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{t}} \href{../exec/conventions.html#exec-notation}{\hookrightarrow^\ast} {z'} ; {\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}})^\ast \\
{\land}~ {({z'} ; {\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}_{\mathsf{e}} \href{../exec/conventions.html#exec-notation}{\hookrightarrow^\ast} {z'} ; {\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}})^\ast}^\ast \\
{\land}~ ({s'}, {\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}) = {\href{../exec/modules.html#alloc-module}{\mathrm{allocmodule}}}(s, {\href{../syntax/modules.html#syntax-module}{\mathit{module}}}, {{\href{../exec/runtime.html#syntax-externaddr}{\mathit{externaddr}}}^\ast}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}, {{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}^\ast}, {({{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast})^\ast}) \\
{\land}~ {{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{d}}^\ast} = {\href{../syntax/conventions.html#notation-concat}{\bigoplus}}\, {{{\href{../exec/modules.html#aux-rundata}{\mathrm{rundata}}}}_{i_{\mathsf{d}}}({{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}{}[i_{\mathsf{d}}])^{i_{\mathsf{d}}&lt;{|{{\href{../syntax/modules.html#syntax-data}{\mathit{data}}}^\ast}|}}} \\
{\land}~ {{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{e}}^\ast} = {\href{../syntax/conventions.html#notation-concat}{\bigoplus}}\, {{{\href{../exec/modules.html#aux-runelem}{\mathrm{runelem}}}}_{i_{\mathsf{e}}}({{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}{}[i_{\mathsf{e}}])^{i_{\mathsf{e}}&lt;{|{{\href{../syntax/modules.html#syntax-elem}{\mathit{elem}}}^\ast}|}}} \\
{\land}~ {{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}_{\mathsf{s}}^?} = {(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{call}}~x)^?} \\
\end{array}
} \\
\end{array}\end{split}\]</div>
<p>where:</p>
</section>
<section id="xref-exec-modules-eval-globals-mathrm-evalglobal-ast-z-xref-syntax-types-syntax-globaltype-mathit-globaltype-ast-xref-syntax-instructions-syntax-expr-mathit-expr-ast">
<span id="eval-globals"></span><h3><span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{(z, {{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}, {{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}''}^\ast})}\)</span><a class="headerlink" href="#xref-exec-modules-eval-globals-mathrm-evalglobal-ast-z-xref-syntax-types-syntax-globaltype-mathit-globaltype-ast-xref-syntax-instructions-syntax-expr-mathit-expr-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}''}^\ast} = \epsilon\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Assert: Due to validation, <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast} = \epsilon\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
</ol>
</li>
<li><p>Else:</p>
<ol class="loweralpha simple">
<li><p>Let <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}~{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}'}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}''}^\ast}\)</span>.</p></li>
<li><p>Assert: Due to validation, <span class="math notranslate nohighlight">\({|{{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}|} \geq 1\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({\mathit{gt}}~{{\mathit{gt}'}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}}^\ast}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((s, f)\)</span> be the destructuring of <span class="math notranslate nohighlight">\(z\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}}\)</span> be the result of <a class="reference internal" href="instructions.html#exec-expr"><span class="std std-ref">evaluating</span></a> <span class="math notranslate nohighlight">\({\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}\)</span> with state <span class="math notranslate nohighlight">\(z\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(a\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}}(s, {\mathit{gt}}, {\href{../exec/runtime.html#syntax-val}{\mathit{val}}})\)</span>.</p></li>
<li><p>Append <span class="math notranslate nohighlight">\(a\)</span> to <span class="math notranslate nohighlight">\(f{.}\href{../exec/runtime.html#syntax-frame}{\mathsf{module}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^\ast}\)</span> be <span class="math notranslate nohighlight">\({{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{((s, f), {{\mathit{gt}'}^\ast}, {{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}'}^\ast})}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}}~{{\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^\ast}\)</span>.</p></li>
</ol>
</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{(z, \epsilon, \epsilon)} &amp; = &amp; (z, \epsilon) \\
{{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{(z, {\mathit{gt}}~{{\mathit{gt}'}^\ast}, {\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}~{{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}'}^\ast})} &amp; = &amp; ({z'}, {\href{../exec/runtime.html#syntax-val}{\mathit{val}}}~{{\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^\ast}) &amp;  \\
&amp;&amp; \multicolumn{2}{&#64;{}l&#64;{}}{\quad
\quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ z ; {\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}} \href{../exec/conventions.html#exec-notation}{\hookrightarrow^\ast} z ; {\href{../exec/runtime.html#syntax-val}{\mathit{val}}} \\
{\land}~ z = s ; f \\
{\land}~ ({s'}, a) = {\href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}}(s, {\mathit{gt}}, {\href{../exec/runtime.html#syntax-val}{\mathit{val}}}) \\
{\land}~ ({z'}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^\ast}) = {{{\href{../exec/modules.html#eval-globals}{\mathrm{evalglobal}}}^\ast}}{(({s'} ; f{}[{.}\href{../exec/runtime.html#syntax-frame}{\mathsf{module}}{.}\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{globals}} \mathrel{{=}{\oplus}} a]), {{\mathit{gt}'}^\ast}, {{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}'}^\ast})} \\
\end{array}
} \\
\end{array}\end{split}\]</div>
</section>
<section id="xref-exec-modules-aux-rundata-mathrm-rundata-x-xref-syntax-modules-syntax-data-mathsf-data-b-n-xref-syntax-modules-syntax-datamode-mathit-datamode">
<span id="aux-runelem"></span><span id="aux-rundata"></span><h3><span class="math notranslate nohighlight">\({{\href{../exec/modules.html#aux-rundata}{\mathrm{rundata}}}}_{x}(\href{../syntax/modules.html#syntax-data}{\mathsf{data}}~{b^{n}}~{\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}})\)</span><a class="headerlink" href="#xref-exec-modules-aux-rundata-mathrm-rundata-x-xref-syntax-modules-syntax-data-mathsf-data-b-n-xref-syntax-modules-syntax-datamode-mathit-datamode" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}} = \href{../syntax/modules.html#syntax-datamode}{\mathsf{passive}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Return <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
</ol>
</li>
<li><p>Assert: Due to validation, <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-datamode}{\mathsf{active}}~{\href{../syntax/modules.html#syntax-memidx}{\mathit{memidx}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-datamode}{\mathsf{active}}~y~{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-datamode}{\mathit{datamode}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast}~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~0)~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~n)~(\href{../syntax/instructions.html#syntax-instr-memory}{\mathsf{memory{.}init}}~y~x)~(\href{../syntax/instructions.html#syntax-instr-memory}{\mathsf{data{.}drop}}~x)\)</span>.</p></li>
</ol>
</section>
<section id="xref-exec-modules-aux-runelem-mathrm-runelem-x-xref-syntax-modules-syntax-elem-mathsf-elem-mathit-rt-e-n-xref-syntax-modules-syntax-elemmode-mathit-elemmode">
<h3><span class="math notranslate nohighlight">\({{\href{../exec/modules.html#aux-runelem}{\mathrm{runelem}}}}_{x}(\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\mathit{rt}}~{e^{n}}~{\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}})\)</span><a class="headerlink" href="#xref-exec-modules-aux-runelem-mathrm-runelem-x-xref-syntax-modules-syntax-elem-mathsf-elem-mathit-rt-e-n-xref-syntax-modules-syntax-elemmode-mathit-elemmode" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}} = \href{../syntax/modules.html#syntax-elemmode}{\mathsf{passive}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Return <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p></li>
</ol>
</li>
<li><p>If <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}} = \href{../syntax/modules.html#syntax-elemmode}{\mathsf{declare}}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Return <span class="math notranslate nohighlight">\((\href{../syntax/instructions.html#syntax-instr-table}{\mathsf{elem{.}drop}}~x)\)</span>.</p></li>
</ol>
</li>
<li><p>Assert: Due to validation, <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-elemmode}{\mathsf{active}}~{\href{../syntax/modules.html#syntax-tableidx}{\mathit{tableidx}}}~{\href{../syntax/instructions.html#syntax-expr}{\mathit{expr}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-elemmode}{\mathsf{active}}~y~{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast})\)</span> be the destructuring of <span class="math notranslate nohighlight">\({\href{../syntax/modules.html#syntax-elemmode}{\mathit{elemmode}}}\)</span>.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast}~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~0)~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~n)~(\href{../syntax/instructions.html#syntax-instr-table}{\mathsf{table{.}init}}~y~x)~(\href{../syntax/instructions.html#syntax-instr-table}{\mathsf{elem{.}drop}}~x)\)</span>.</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{{\href{../exec/modules.html#aux-rundata}{\mathrm{rundata}}}}_{x}(\href{../syntax/modules.html#syntax-data}{\mathsf{data}}~{b^{n}}~(\href{../syntax/modules.html#syntax-datamode}{\mathsf{passive}})) &amp; = &amp; \epsilon \\
{{\href{../exec/modules.html#aux-rundata}{\mathrm{rundata}}}}_{x}(\href{../syntax/modules.html#syntax-data}{\mathsf{data}}~{b^{n}}~(\href{../syntax/modules.html#syntax-datamode}{\mathsf{active}}~y~{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast})) &amp; = &amp; &amp; \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\begin{array}[t]{&#64;{}l&#64;{}}
{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast}~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~0)~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~n)~(\href{../syntax/instructions.html#syntax-instr-memory}{\mathsf{memory{.}init}}~y~x)~(\href{../syntax/instructions.html#syntax-instr-memory}{\mathsf{data{.}drop}}~x) \\
\end{array}
} \\[0.8ex]
{{\href{../exec/modules.html#aux-runelem}{\mathrm{runelem}}}}_{x}(\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\mathit{rt}}~{e^{n}}~(\href{../syntax/modules.html#syntax-elemmode}{\mathsf{passive}})) &amp; = &amp; \epsilon \\
{{\href{../exec/modules.html#aux-runelem}{\mathrm{runelem}}}}_{x}(\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\mathit{rt}}~{e^{n}}~(\href{../syntax/modules.html#syntax-elemmode}{\mathsf{declare}})) &amp; = &amp; (\href{../syntax/instructions.html#syntax-instr-table}{\mathsf{elem{.}drop}}~x) \\
{{\href{../exec/modules.html#aux-runelem}{\mathrm{runelem}}}}_{x}(\href{../syntax/modules.html#syntax-elem}{\mathsf{elem}}~{\mathit{rt}}~{e^{n}}~(\href{../syntax/modules.html#syntax-elemmode}{\mathsf{active}}~y~{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast})) &amp; = &amp; &amp; \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\begin{array}[t]{&#64;{}l&#64;{}}
{{\href{../syntax/instructions.html#syntax-instr}{\mathit{instr}}}^\ast}~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~0)~(\href{../syntax/types.html#syntax-numtype}{\mathsf{i\scriptstyle32}}{.}\href{../syntax/instructions.html#syntax-instr-numeric}{\mathsf{const}}~n)~(\href{../syntax/instructions.html#syntax-instr-table}{\mathsf{table{.}init}}~y~x)~(\href{../syntax/instructions.html#syntax-instr-table}{\mathsf{elem{.}drop}}~x) \\
\end{array}
} \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Checking import types assumes that the <a class="reference internal" href="runtime.html#syntax-moduleinst"><span class="std std-ref">module instance</span></a> has already been <a class="reference internal" href="#alloc-module"><span class="std std-ref">allocated</span></a> to compute the respective <a class="reference internal" href="../valid/conventions.html#type-closed"><span class="std std-ref">closed</span></a> <a class="reference internal" href="../valid/conventions.html#syntax-deftype"><span class="std std-ref">defined types</span></a>.
However, this forward reference merely is a way to simplify the specification.
In practice, implementations will likely allocate or canonicalize types beforehand, when <em>compiling</em> a module, in a stage before instantiation and before imports are checked.</p>
<p>Similarly, module <a class="reference internal" href="#alloc-module"><span class="std std-ref">allocation</span></a> and the <a class="reference internal" href="instructions.html#exec-expr"><span class="std std-ref">evaluation</span></a> of <a class="reference internal" href="../syntax/modules.html#syntax-global"><span class="std std-ref">global</span></a> and <a class="reference internal" href="../syntax/modules.html#syntax-table"><span class="std std-ref">table</span></a> initializers as well as <a class="reference internal" href="../syntax/modules.html#syntax-elem"><span class="std std-ref">element segments</span></a> are mutually recursive because the global initialization <a class="reference internal" href="runtime.html#syntax-val"><span class="std std-ref">values</span></a> <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{g}}^\ast}\)</span>, <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{t}}\)</span>, and element segment contents <span class="math notranslate nohighlight">\({{{\href{../exec/runtime.html#syntax-ref}{\mathit{ref}}}_{\mathsf{e}}^\ast}^\ast}\)</span> are passed to the module allocator while depending on the module instance <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}}\)</span> and store <span class="math notranslate nohighlight">\({s'}\)</span> returned by allocation.
Again, this recursion is just a specification device.
In practice, the initialization values can <a class="reference internal" href="#exec-initvals"><span class="std std-ref">be determined</span></a> beforehand by staging module allocation such that first, the module’s own <a class="reference internal" href="runtime.html#syntax-funcinst"><span class="std std-ref">function instances</span></a> are pre-allocated in the store, then the initializer expressions are evaluated in order, allocating globals on the way, then the rest of the module instance is allocated, and finally the new function instances’ <span class="math notranslate nohighlight">\(\mathsf{module}\)</span> fields are set to that module instance.
This is possible because <a class="reference internal" href="../valid/modules.html#valid-module"><span class="std std-ref">validation</span></a> ensures that initialization expressions cannot actually call a function, only take their reference.</p>
<p>All failure conditions are checked before any observable mutation of the store takes place.
Store mutation is not atomic;
it happens in individual steps that may be interleaved with other threads.</p>
<p><a class="reference internal" href="instructions.html#exec-expr"><span class="std std-ref">Evaluation</span></a> of <a class="reference internal" href="../valid/instructions.html#valid-constant"><span class="std std-ref">constant expressions</span></a> does not affect the store.</p>
</div>
</section>
</section>
<section id="invocation">
<span id="exec-invocation"></span><span id="index-12"></span><h2>Invocation<a class="headerlink" href="#invocation" title="Link to this heading">¶</a></h2>
<section id="xref-exec-modules-exec-invocation-mathrm-invoke-s-xref-exec-runtime-syntax-funcaddr-mathit-funcaddr-xref-exec-runtime-syntax-val-mathit-val-ast">
<h3><span class="math notranslate nohighlight">\({\href{../exec/modules.html#exec-invocation}{\mathrm{invoke}}}(s, {\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast})\)</span><a class="headerlink" href="#xref-exec-modules-exec-invocation-mathrm-invoke-s-xref-exec-runtime-syntax-funcaddr-mathit-funcaddr-xref-exec-runtime-syntax-val-mathit-val-ast" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Assert: Due to validation, the <a class="reference internal" href="../valid/conventions.html#aux-expand-deftype"><span class="std std-ref">expansion</span></a> of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}{}[{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}]{.}\href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}\)</span> is some <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-comptype}{\mathsf{func}}~{\href{../syntax/types.html#syntax-resulttype}{\mathit{resulttype}}} \href{../syntax/types.html#syntax-comptype}{\rightarrow} {\href{../syntax/types.html#syntax-resulttype}{\mathit{resulttype}}}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\((\href{../syntax/types.html#syntax-comptype}{\mathsf{func}}~{t_1^\ast}~\href{../syntax/types.html#syntax-comptype}{\rightarrow}~{t_2^\ast})\)</span> be the destructuring of the <a class="reference internal" href="../valid/conventions.html#aux-expand-deftype"><span class="std std-ref">expansion</span></a> of <span class="math notranslate nohighlight">\(s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}{}[{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}]{.}\href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}\)</span>.</p></li>
<li><p>If <span class="math notranslate nohighlight">\({|{t_1^\ast}|} \neq {|{{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast}|}\)</span>, then:</p>
<ol class="loweralpha simple">
<li><p>Fail.</p></li>
</ol>
</li>
<li><p>For all <span class="math notranslate nohighlight">\(t_1\)</span> in <span class="math notranslate nohighlight">\({t_1^\ast}\)</span>, and corresponding <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}}\)</span> in <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast}\)</span>:</p>
<ol class="loweralpha simple">
<li><p>If <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}}\)</span> is not <a class="reference internal" href="values.html#valid-val"><span class="std std-ref">valid</span></a> with type <span class="math notranslate nohighlight">\(t_1\)</span>, then:</p>
<ol class="arabic simple">
<li><p>Fail.</p></li>
</ol>
</li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\(k\)</span> be the length of <span class="math notranslate nohighlight">\({t_2^\ast}\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(F\)</span> be the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~\{  \} \}\)</span> whose arity is <span class="math notranslate nohighlight">\(k\)</span>.</p></li>
<li><p>Push the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> <span class="math notranslate nohighlight">\(F\)</span>.</p></li>
<li><p>Push the values <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast}\)</span> to the stack.</p></li>
<li><p>Push the value <span class="math notranslate nohighlight">\((\href{../exec/runtime.html#syntax-ref}{\mathsf{ref{.}func}}~{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}})\)</span> to the stack.</p></li>
<li><p>Execute the instruction <span class="math notranslate nohighlight">\((\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{call\_ref}}~s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}{}[{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}]{.}\href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}})\)</span>.</p></li>
<li><p>Pop the values <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^{k}}\)</span> from the stack.</p></li>
<li><p>Pop the <span class="math notranslate nohighlight">\(\mathsf{frame}\)</span> from the stack.</p></li>
<li><p>Return <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^{k}}\)</span>.</p></li>
</ol>
<p>Once a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a> has been <a class="reference internal" href="#exec-instantiation"><span class="std std-ref">instantiated</span></a>, any exported function can be <em>invoked</em> externally via its <a class="reference internal" href="runtime.html#syntax-funcaddr"><span class="std std-ref">function address</span></a> <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}\)</span> in the <a class="reference internal" href="runtime.html#syntax-store"><span class="std std-ref">store</span></a> <span class="math notranslate nohighlight">\(s\)</span> and an appropriate list <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast}\)</span> of argument <a class="reference internal" href="runtime.html#syntax-val"><span class="std std-ref">values</span></a>.</p>
<p>Invocation may <em>fail</em> with an error if the arguments do not fit the <a class="reference internal" href="../syntax/types.html#syntax-functype"><span class="std std-ref">function type</span></a>.
Invocation can also result in an <a class="reference internal" href="../syntax/instructions.html#exception"><span class="std std-ref">exception</span></a> or <a class="reference internal" href="../intro/overview.html#trap"><span class="std std-ref">trap</span></a>.
It is up to the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> to define how such conditions are reported.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the <a class="reference internal" href="../intro/overview.html#embedder"><span class="std std-ref">embedder</span></a> API performs type checks itself, either statically or dynamically, before performing an invocation, then no failure other than traps or exceptions can occur.</p>
</div>
<p>The following steps are performed:</p>
<ol class="arabic simple">
<li><p>Assert: <span class="math notranslate nohighlight">\(S.\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}[\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}]\)</span> exists.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}\)</span> be the <a class="reference internal" href="runtime.html#syntax-funcinst"><span class="std std-ref">function instance</span></a> <span class="math notranslate nohighlight">\(S.\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}[\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}]\)</span>.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-comptype}{\mathsf{func}}~[t_1^n] \href{../syntax/types.html#syntax-comptype}{\rightarrow} [t_2^m]\)</span> be the <a class="reference internal" href="../syntax/types.html#syntax-comptype"><span class="std std-ref">composite type</span></a> <span class="math notranslate nohighlight">\(\href{../valid/conventions.html#aux-expand-deftype}{\mathrm{expand}}(\href{../exec/runtime.html#syntax-funcinst}{\mathit{funcinst}}.\href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}})\)</span>.</p></li>
<li><p>If the length <span class="math notranslate nohighlight">\(|\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast|\)</span> of the provided argument values is different from the number <span class="math notranslate nohighlight">\(n\)</span> of expected arguments, then:</p>
<ol class="loweralpha simple">
<li><p>Fail.</p></li>
</ol>
</li>
<li><p>For each <a class="reference internal" href="../syntax/types.html#syntax-valtype"><span class="std std-ref">value type</span></a> <span class="math notranslate nohighlight">\(t_i\)</span> in <span class="math notranslate nohighlight">\(t_1^n\)</span> and corresponding <a class="reference internal" href="runtime.html#syntax-val"><span class="std std-ref">value</span></a> <span class="math notranslate nohighlight">\(val_i\)</span> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast\)</span>, do:</p>
<ol class="loweralpha simple">
<li><p>If <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}_i\)</span> is not <a class="reference internal" href="values.html#valid-val"><span class="std std-ref">valid</span></a> with value type <span class="math notranslate nohighlight">\(t_i\)</span>, then:</p>
<ol class="lowerroman simple">
<li><p>Fail.</p></li>
</ol>
</li>
</ol>
</li>
<li><p>Let <span class="math notranslate nohighlight">\(F\)</span> be the dummy <a class="reference internal" href="runtime.html#syntax-frame"><span class="std std-ref">frame</span></a> <span class="math notranslate nohighlight">\(\{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~\{\}, \href{../exec/runtime.html#syntax-frame}{\mathsf{locals}}~\epsilon \}\)</span>.</p></li>
<li><p>Push the frame <span class="math notranslate nohighlight">\(F\)</span> to the stack.</p></li>
<li><p>Push the values <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast\)</span> to the stack.</p></li>
<li><p><a class="reference internal" href="instructions.html#exec-invoke"><span class="std std-ref">Invoke</span></a> the function instance at address <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}\)</span>.</p></li>
</ol>
<p>Once the function has returned, the following steps are executed:</p>
<ol class="arabic simple">
<li><p>Assert: due to <a class="reference internal" href="../valid/modules.html#valid-func"><span class="std std-ref">validation</span></a>, <span class="math notranslate nohighlight">\(m\)</span> <a class="reference internal" href="runtime.html#syntax-val"><span class="std std-ref">values</span></a> are on the top of the stack.</p></li>
<li><p>Pop <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}_{\mathrm{res}}^m\)</span> from the stack.</p></li>
<li><p>Assert: due to <a class="reference internal" href="../valid/modules.html#valid-module"><span class="std std-ref">validation</span></a>, the frame <span class="math notranslate nohighlight">\(F\)</span> is now on the top of the stack.</p></li>
<li><p>Pop the frame <span class="math notranslate nohighlight">\(F\)</span> from the stack.</p></li>
</ol>
<p>The values <span class="math notranslate nohighlight">\({{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}_{\mathsf{res}}^{m}}\)</span> are returned as the results of the invocation.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}[t]{&#64;{}lcl&#64;{}l&#64;{}}
{\href{../exec/modules.html#exec-invocation}{\mathrm{invoke}}}(s, {\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}, {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast}) &amp; = &amp; s ; \{ \href{../exec/runtime.html#syntax-frame}{\mathsf{module}}~\{  \} \} ; {{\href{../exec/runtime.html#syntax-val}{\mathit{val}}}^\ast}~(\href{../exec/runtime.html#syntax-ref}{\mathsf{ref{.}func}}~{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}})~(\href{../syntax/instructions.html#syntax-instr-control}{\mathsf{call\_ref}}~s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}{}[{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}]{.}\href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}}) &amp;  \\
 \multicolumn{4}{&#64;{}l&#64;{}}{\quad
\quad
\begin{array}[t]{&#64;{}l&#64;{}}
\mbox{if}~ s{.}\href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}{}[{\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}}]{.}\href{../exec/runtime.html#syntax-funcinst}{\mathsf{type}} \mathrel{\href{../valid/conventions.html#aux-expand-deftype}{\approx}} \href{../syntax/types.html#syntax-comptype}{\mathsf{func}}~{t_1^\ast} \href{../syntax/types.html#syntax-comptype}{\rightarrow} {t_2^\ast} \\
{\land}~ (s \href{../exec/values.html#valid-val}{\vdash} {\href{../exec/runtime.html#syntax-val}{\mathit{val}}} : t_1)^\ast \\
\end{array}
} \\
\end{array}\end{split}\]</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2017-2025, WebAssembly Community Group.
      
    </div>

    

    
  </body>
</html>