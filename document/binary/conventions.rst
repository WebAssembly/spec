.. index:: ! binary format

Conventions
-----------

The binary format for WebAssembly :ref:`modules <modules>` is a dense linear *encoding* of their :ref:`abstract syntax <syntax-module>`.
[#compression]_

The format is defined by an *attribute grammar* whose only terminal symbols are :ref:`bytes <syntax-byte>`.
A byte sequence is a well-formed encoding of a module if and only if it is generated by the grammar.

Each production of this grammar has exactly one synthesized attribute: the abstract syntax that the respective byte sequence encodes.
Thus, the attribute grammar implicitly defines a *decoding* function.

Except for a few exceptions, the binary grammar closely mirrors the grammar of the abstract syntax.

.. note::
   Some phrases of abstract syntax have multiple possible encodings in the binary format.
   For example, numbers may be encoded as if they had optional leading zeros.
   Implementations of encoders producing WebAssembly binaries can pick any encoding.

.. [#compression]
   Additional encoding layers -- for example, introducing compression -- may be defined on top of the basic representation defined here.
   However, such layers are outside the scope of the current specification.


.. _binary-grammar:
.. index:: grammar notation, notation, byte
   single: binary format; grammar
   pair: binary format; notation

Grammar
~~~~~~~

The following conventions are adopted in defining grammar rules for the binary format.
They mirror the conventions used for :ref:`abstract syntax <grammar>`.
In order to distinguish symbols of the binary syntax from symbols of the abstract syntax, typewriter font is adopted for the former.

* Terminal symbols are :ref:`bytes <syntax-byte>` expressed in hexadecimal notation: :math:`\hex{0F}`.

* Nonterminal symbols are written in typewriter font: :math:`\B{valtype}, \B{instr}`.

* :math:`B^n` is a sequence of :math:`n\geq 0` iterations  of :math:`B`.

* :math:`B^\ast` is a possibly empty sequence of iterations of :math:`B`.
  (This is a shorthand for :math:`A^n` used where :math:`n` is not relevant.)

* :math:`B^?` is an optional occurrence of :math:`B`.
  (This is a shorthand for :math:`A^n` where :math:`n \leq 1`.)

* :math:`x{:}B` denotes the same language as the nonterminal :math:`B`, but also binds the variable :math:`x` to the attribute synthesized for :math:`B`.

* Productions are written :math:`\B{B} ::= B \Rightarrow A`, where :math:`A` is the attribute that is synthesized for :math:`\B{B}`, usually from attribute variables bound in :math:`B`.


.. note::
   For example, the :ref:`binary grammar <binary-valtype>` for :ref:`value types <syntax-valtype>` is given as follows:

   .. math::
     \begin{array}{llcll@{\qquad\qquad}l}
     \production{value types} & \Bvaltype &::=&
       \hex{7F} &\Rightarrow& \I32 \\ &&|&
       \hex{7E} &\Rightarrow& \I64 \\ &&|&
       \hex{7D} &\Rightarrow& \F32 \\ &&|&
       \hex{7C} &\Rightarrow& \F64 \\
     \end{array}

   Consequently, the byte :math:`\hex{7F}` encodes the type |I32|,
   :math:`\hex{7E}` encodes the type |I64|, and so forth.
   No other byte value is allowed as the encoding of a value type.

   The :ref:`binary grammar <binary-limits>` for :ref:`limits <syntax-limits>` is defined as follows:   

   .. math::
      \begin{array}{llcll}
      \production{limits} & \Blimits &::=&
        \hex{00}~~n{:}\Bu32 &\Rightarrow& \{ \MIN~n, \MAX~\epsilon \} \\ &&|&
        \hex{01}~~n{:}\Bu32~~m{:}\Bu32 &\Rightarrow& \{ \MIN~n, \MAX~m \} \\
      \end{array}

   That is, a limits pair is encoded as either the byte :math:`\hex{00}` followed by the encoding of a |U32| value,
   or the byte :math:`\hex{01}` followed by the encoding of two such values. 
   The variables :math:`n` and :math:`m` name the attributes of the respective |Bu32| nonterminals, which are the actual :ref:`unsigned integers <syntax-uint>` they decode into.
   The attribute of the complete production then is the abstract syntax for the limit, expressed in terms of the former values.


Auxiliary Notation
~~~~~~~~~~~~~~~~~~

When dealing with binary encodings the following notation is also used:

* :math:`\epsilon` denotes the empty byte sequence.

* :math:`|B|` is the length of the byte sequence generated from the production :math:`B` in a derivation.
